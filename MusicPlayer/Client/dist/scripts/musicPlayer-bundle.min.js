/*
 * Music Player v1.0.0 (https://github.com/vittorioPiotti/Music-Player/releases/tag/1.0.0)
 * Copyright 2024 Vittorio Piotti
 * Licensed under GPL-3.0 (https://github.com/vittorioPiotti/Music-Player/blob/main/LICENSE.md)
 */

/**
 * Swiper 11.1.4
 * Most modern mobile touch slider and framework with hardware accelerated transitions
 * https://swiperjs.com
 *
 * Copyright 2014-2024 Vladimir Kharlampidi
 *
 * Released under the MIT License
 *
 * Released on: May 30, 2024
 */

/*!
 * clipboard.js v2.0.11
 * https://clipboardjs.com/
 *
 * Licensed MIT © Zeno Rocha
 */

/*!
 * Bootstrap v4.0.0 (https://getbootstrap.com)
 * Copyright 2011-2018 The Bootstrap Authors
 * Copyright 2011-2018 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
*/
class WorkerManager{constructor(){this.workers=[];this.completedWorkers=0;this.terminated=false;this.totalDurationAudios=0}fetchWorker(action,data={},callback){return new Promise(((resolve,reject)=>{const worker=this.createWorker("./src/app/workers/fetchWorker.js",{action:action,...data});worker.onmessage=async event=>{const{success:success,action:responseAction,data:responseData,error:error}=event.data;if(this.terminated){this.terminateAndRemoveWorker(worker);reject("Operation was interrupted");return}if(success&&responseAction===action){if(typeof callback==="function")callback(responseData);resolve(responseData)}else{reject(error)}this.terminateAndRemoveWorker(worker)};worker.onerror=event=>{if(this.terminated){this.terminateAndRemoveWorker(worker);return}reject(event.message);this.terminateAndRemoveWorker(worker)}}))}async fetchOneAudioWorker(url,index){return new Promise(((resolve,reject)=>{const worker=this.createWorker("./src/app/workers/audioWorker.js",{url:url,index:index});worker.onmessage=async event=>{if(this.terminated){this.terminateAndRemoveWorker(worker);reject("Operation was interrupted");return}if(event.data.error){this.terminateAndRemoveWorker(worker);reject(event.data.error);return}try{const audioContext=new(window.AudioContext||window.webkitAudioContext);const audioBuffer=await audioContext.decodeAudioData(event.data.arrayBuffer);const duration=audioBuffer.duration;resolve(duration)}catch(e){reject(e.message)}finally{this.terminateAndRemoveWorker(worker)}};worker.onerror=event=>{if(this.terminated){this.terminateAndRemoveWorker(worker);return}reject(event.message);this.terminateAndRemoveWorker(worker)}}))}fetchAudioWorker(url,index,callback){return new Promise(((resolve,reject)=>{const worker=this.createWorker("./src/app/workers/audioWorker.js",{url:url,index:index});worker.onmessage=async event=>{if(this.terminated){this.terminateAndRemoveWorker(worker);reject("Operation was interrupted");return}if(event.data.error){this.terminateAndRemoveWorker(worker);reject(event.data.error);return}try{const audioContext=new(window.AudioContext||window.webkitAudioContext);const audioBuffer=await audioContext.decodeAudioData(event.data.arrayBuffer);const result={index:event.data.index,duration:audioBuffer.duration};this.totalDurationAudios+=result.duration;resolve(result)}catch(e){reject(e.message)}finally{this.terminateAndRemoveWorker(worker);this.completedWorkers++;if(!this.terminated&&this.completedWorkers===this.opera.canzoni.length){callback(this.totalDurationAudios)}}};worker.onerror=event=>{if(this.terminated){this.terminateAndRemoveWorker(worker);return}reject(event.message);this.terminateAndRemoveWorker(worker);this.completedWorkers++;if(!this.terminated&&this.completedWorkers===this.opera.canzoni.length){callback(this.totalDurationAudios)}}}))}stopAllWorkers(){this.terminated=true;this.workers.forEach((worker=>{worker.postMessage("terminate");worker.terminate()}));this.workers=[]}resetWorkers(){this.workers=[];this.totalDurationAudios=0;this.completedWorkers=0;this.terminated=false}createWorker(workerPath,postData){const worker=new Worker(workerPath);this.workers.push(worker);worker.postMessage(postData);return worker}terminateAndRemoveWorker(worker){worker.terminate();this.removeWorker(worker)}removeWorker(worker){const index=this.workers.indexOf(worker);if(index>-1){this.workers.splice(index,1)}}}class Constants{static URL=(page,params)=>`https://vittoriopiotti.altervista.org/MusicPlayer/Client/index.php?page=${page}${params}`;static CHEVRON_LEFT=`\n    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-chevron-left" viewBox="0 0 16 16">\n        <path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0"/>\n    </svg>\n    \n    `;static LOADING=(dim,mb,mt,sw)=>`\n    <svg width="${dim}" height="${dim}" style="margin:auto;margin-bottom:${mb}px;margin-top:${mt}px;" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">\n  \x3c!-- Cerchio animato --\x3e\n  <circle cx="50" cy="50" r="45" stroke="#3498db" stroke-width="${sw}" fill="none" stroke-linecap="round"\n          stroke-dasharray="70,213" style="transform-origin: center; opacity: 0;">\n    \x3c!-- Animazione della trasformazione per la scala --\x3e\n    <animateTransform\n      attributeName="transform"\n      type="scale"\n      from="0 0"\n      to="1 1"\n      begin="0s"\n      dur="0.5s"\n      fill="freeze"\n    />\n    \x3c!-- Animazione dell'opacitÃ  per il fade-in --\x3e\n    <animate\n      attributeName="opacity"\n      from="0"\n      to="1"\n      begin="0s"\n      dur="0.3s"\n      fill="freeze"\n    />\n    \x3c!-- Animazione dello spostamento del tratteggio per dare effetto di rotazione --\x3e\n    <animate\n      attributeName="stroke-dashoffset"\n      values="0; -283"\n      keyTimes="0; 1"\n      dur="1s"\n      repeatCount="indefinite"\n      keySplines="0.42 0 0.58 1"\n      calcMode="linear"\n    />\n    \x3c!-- Animazione del colore per dare un effetto dinamico --\x3e\n    <animate\n      attributeName="stroke"\n      values="rgb(229, 92, 156); rgb(229, 67, 78); rgb(229, 92, 156); rgb(229, 67, 78);"\n      dur="1s"\n      repeatCount="indefinite"\n    />\n  </circle>\n</svg>\n`;static LOADING_SECOND=(classe,dim,mt,mb,sw)=>`\n    <div class="animated-circle ${classe}"  style="width:${dim}px; height:${dim}px; margin:auto; margin-bottom:${mb}px; margin-top:${mt}px;">\n        <svg width="100%" height="100%" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">\n          <circle cx="50" cy="50" r="45" stroke="#3498db" stroke-width="${sw}" fill="none" stroke-linecap="round"></circle>\n        </svg>\n      </div>`;static LOADING_THIRD=(classe,dim,m,mt,mb,ms,me,sw)=>`\n    <div class="animated-circle ${classe}"  style="width:${dim}px; height:${dim}px; margin:${m}; margin-bottom:${mb}px; margin-top:${mt}px;margin-left:${ms}px; margin-right:${me}px;">\n        <svg width="100%" height="100%" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">\n          <circle cx="50" cy="50" r="45" stroke="#3498db" stroke-width="${sw}" fill="none" stroke-linecap="round"></circle>\n        </svg>\n      </div>`;static EXPLICIT=(elemType,dim,marginLeft,borderRadius)=>`\n    <${elemType} \n     \n        style="\n            width:${dim}px;\n            height:${dim}px;\n            position:relative;\n            display:flex;\n            align-items: center;\n            justify-content: center;\n        "    \n    >\n    <svg \n        xmlns="http://www.w3.org/2000/svg" \n        width="${dim}" \n        height="${dim}" \n        style="\n            margin-left:${marginLeft}px;\n            border-radius:${borderRadius}px;\n            z-index:101;\n        " \n        fill="rgb(180,180,180)"  \n        viewBox="0 0 16 16">\n        <path d="M2.5 0A2.5 2.5 0 0 0 0 2.5v11A2.5 2.5 0 0 0 2.5 16h11a2.5 2.5 0 0 0 2.5-2.5v-11A2.5 2.5 0 0 0 13.5 0zm4.326 10.88H10.5V12h-5V4.002h5v1.12H6.826V7.4h3.457v1.073H6.826z"/>\n   \n    </svg>\n         <${elemType} style="\n            position:absolute;\n            top:0px;\n            left:0px;\n            z-index:100;\n            width:${dim}px;\n            height:${dim}px;\n            background-color:black;\n            border-radius:50%;\n        "></${elemType}>\n    </${elemType}>\n    `;static scrollTop(){window.scrollTo({top:0,behavior:"smooth"})}static POINT=`<span class="pointer-circle-song"></span>`;static PLAY=`\n    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="var(--primary-color)" class="bi bi-play-fill" viewBox="0 0 16 16">\n        <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"/>\n    </svg>`;static PAUSE=`\n        <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="var(--primary-color)" class="bi bi-pause-fill" viewBox="0 0 16 16">\n            <path d="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5m5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5"/>\n        </svg>`;static MUSIC=`\n        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="var(--primary-color)" class="bi bi-bar-chart-fill" viewBox="0 0 16 16">\n            <g>\n                <rect x="1" y="6" width="4" height="10" class="bar bar1"/>\n                <rect x="6" y="2" width="4" height="14" class="bar bar2"/>\n                <rect x="11" y="0" width="4" height="16" class="bar bar3"/>\n            </g>\n        </svg>`}class Animations{static fade(element,callback){if(element){if(!element.classList.contains("fadeOut")){element.classList.add("fadeOut")}if(element.classList.contains("fadeIn")){element.classList.remove("fadeIn")}setTimeout((function(){callback();if(element.classList.contains("fadeOut")){element.classList.remove("fadeOut")}if(!element.classList.contains("fadeIn")){element.classList.add("fadeIn")}}),300)}}static fadeOut(timer,element){element.classList.add("tooltip-visible");if(!element.classList.contains("fadeIn")){element.classList.add("fadeIn")}if(element.classList.contains("fadeOut")){element.classList.remove("fadeOut")}setTimeout((()=>{if(!element.classList.contains("fadeOut")){element.classList.add("fadeOut")}if(element.classList.contains("fadeIn")){element.classList.remove("fadeIn")}}),timer)}static fadeDouble(elementFirst,elementSecond,callback){const elements=[elementFirst,elementSecond];elements.forEach((element=>{if(element){if(!element.classList.contains("fadeOut")){element.classList.add("fadeOut")}if(element.classList.contains("fadeIn")){element.classList.remove("fadeIn")}}}));setTimeout((function(){callback();elements.forEach((element=>{if(element.classList.contains("fadeOut")){element.classList.remove("fadeOut")}if(!element.classList.contains("fadeIn")){element.classList.add("fadeIn")}}))}),300)}static fadeCustomTimer(timer,element,callback){if(element){if(!element.classList.contains("fadeOut")){element.classList.add("fadeOut")}if(element.classList.contains("fadeIn")){element.classList.remove("fadeIn")}setTimeout((function(){callback();if(element.classList.contains("fadeOut")){element.classList.remove("fadeOut")}if(!element.classList.contains("fadeIn")){element.classList.add("fadeIn")}}),timer)}}}class MySwiper{constructor(id,swiperId,obj,isRounded,callbacks,elementType,isAll){this.id=id;this.isAll=isAll;this.swiperId=swiperId;this.obj=obj;this.isRounded=isRounded;this.callbacks=callbacks;this.beyondLastSlide=false;this.elementType=elementType;this.init()}async waitingNewElementsInnerHTML(callback,callbackSecond,lastResult){const swiperElement=document.getElementById(this.id)?.querySelector(".swiper-wrapper");if(!swiperElement){console.warn("Element with ID not found or .swiper-wrapper is missing.");return}this.resetSwiperElementsInnerHTML(`${Constants.LOADING_SECOND(".animated-circle",120,70,50,5)}`);const circle=document.querySelector(".animated-circle circle");if(circle){circle.style.opacity=1}else{console.warn("Element .animated-circle circle not found.")}await new Promise((resolve=>setTimeout(resolve,600)));const inputSearch=document.getElementById("input-search");let text="";if(inputSearch){text=inputSearch.value}switch(text){case"":try{let result=await callback();Animations.fade(this.getSwiper(),(()=>{this.createSwiperElementsInnerHTML(result);this.setEventHandlersOverlay()}))}catch(error){console.error("Error during fetch operation:",error)}break;default:try{let result=await callbackSecond();switch(result.length){case 0:Animations.fade(this.getSwiper(),(()=>{this.resetSwiperElementsInnerHTML(`\n                                    <div class="icon-warning-response">\n                                        <svg xmlns="http://www.w3.org/2000/svg" width="120" height="120" fill="#ffc107" class="bi bi-exclamation-triangle-fill" viewBox="0 0 16 16">\n                                            <path d="M8.982 1.566a1.13 1.13 0 0 0-1.96 0L.165 13.233c-.457.778.091 1.767.98 1.767h13.713c.889 0 1.438-.99.98-1.767zM8 5c.535 0 .954.462.9.995l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 5.995A.905.905 0 0 1 8 5m.002 6a1 1 0 1 1 0 2 1 1 0 0 1 0-2"/>\n                                        </svg>\n                                    </div>`)}));await new Promise((resolve=>setTimeout(resolve,800)));result=lastResult;break;default:break}Animations.fade(this.getSwiper(),(()=>{this.createSwiperElementsInnerHTML(result);this.setEventHandlersOverlay()}))}catch(error){console.error("Error during fetch operation:",error)}break}}resetSwiperElementsInnerHTML(innerHTML){const swiperWrapper=document.getElementById(this.id)?.querySelector(".swiper-wrapper");if(swiperWrapper){swiperWrapper.innerHTML=innerHTML}else{console.warn("Element with ID not found or .swiper-wrapper is missing.")}}getSwiper(){return document.getElementById(this.id)}swiperElementInnerHTML(obj){return obj.map((_obg=>`\n            <div class="swiper-slide" elementId="${_obg.id}" elementType="${this.elementType}">\n                <div class="container-slide"> \n                    <div class="${this.isRounded?"artist-img":"album-img"}" style="background-image:${_obg.image}">\n                        <div class="explicit-container">\n                            ${_obg.isExplicit?Constants.EXPLICIT("div",18,0,3):""}\n                        </div>\n                        ${this.isRounded?``:`\n                            <div class="overlay-container-img">    \n                            </div>\n                            <div class="overlay-container-img-second">\n                                <div class="btn-clickable-play">\n                                    <div class="btn-overlay-img-left"></div>\n                                    <div class="btn-overlay-img-left-svg">\n                                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="white" class="bi bi-play-fill" viewBox="0 0 16 16">\n                                            <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"/>\n                                        </svg>\n                                    </div>\n                                </div>\n                                <div class="btn-clickable-share" data-clipboard-text="${Constants.URL("music",`&idMusic=${_obg.id}`)}">\n                                    <div class="btn-overlay-img-right"></div>\n                                    <div class="btn-overlay-img-right-svg">\n                                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="white" class="bi bi-share-fill" viewBox="0 0 16 16">\n                                            <path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5"/>\n                                        </svg>\n                                    </div>\n                                </div>\n                            </div>\n                        `}\n                    </div>\n                    <div class="container-info">\n                        <div class="nome-album">${_obg.name}</div>    \n                        <div class="info-album">${_obg.genereMusicale}</div>\n                    </div>\n                </div>\n            </div>\n        `)).join("")}createSwiperElementsInnerHTML(obj){const swiperWrapper=document.getElementById(this.id)?.querySelector(".swiper-wrapper");if(swiperWrapper){swiperWrapper.innerHTML=this.swiperElementInnerHTML(obj)}else{console.warn("Element with ID not found or .swiper-wrapper is missing.")}}init(){const container=document.getElementById(this.id);if(container){container.innerHTML=this.innerHTML();this.setupSwiper();this.setupBeyondLastSlideDetection();this.setupClickHandler();this.setEventHandlersOverlay()}else{console.warn("Element with ID not found.")}}setupSwiper(){this.swiper=new Swiper(`#${this.swiperId}`,{slidesPerView:5,slidesPerGroup:5,spaceBetween:25,pagination:false,breakpoints:{"@0.00":{slidesPerView:2,slidesPerGroup:2,spaceBetween:10},"@0.75":{slidesPerView:3,slidesPerGroup:3,spaceBetween:15},"@1.00":{slidesPerView:4,slidesPerGroup:4,spaceBetween:20},"@1.25":{slidesPerView:5,slidesPerGroup:5,spaceBetween:25}}})}setupBeyondLastSlideDetection(){this.swiper.on("setTranslate",(()=>{const{progress:progress,isEnd:isEnd}=this.swiper;if(isEnd&&progress>1&&this.isAll==false){if(!this.beyondLastSlide){this.beyondLastSlide=true;Animations.fade(document.getElementById(this.id),(async()=>{const inputSearch=document.getElementById("input-search");if(inputSearch){inputSearch.disabled=true}await this.callbacks.touchEnd();setTimeout((()=>{if(inputSearch){inputSearch.disabled=false}}),1e3)}))}}else{this.beyondLastSlide=false}}))}setupClickHandler(){const swiperContainer=document.querySelector(`#${this.id}`);if(swiperContainer){swiperContainer.addEventListener("click",(event=>{const clickedSlide=event.target.closest(".swiper-slide");if(clickedSlide){const elementId=clickedSlide.getAttribute("elementId");const elementType=clickedSlide.getAttribute("elementType");Animations.fade(clickedSlide,(()=>{this.callbacks.onClick(elementId,elementType)}))}}))}}setEventHandlersOverlay(){const swiperContainer=document.getElementById(this.swiperId);if(swiperContainer){const playButtons=swiperContainer.querySelectorAll(".btn-clickable-play");playButtons.forEach((button=>{const leftOverlay=button.querySelector(".btn-overlay-img-left");const leftSvgOverlay=button.querySelector(".btn-overlay-img-left-svg");button.addEventListener("click",(event=>{event.stopPropagation();const swiperSlide=button.closest(".swiper-slide");if(swiperSlide){const elementId=swiperSlide.getAttribute("elementId");const elementType=swiperSlide.getAttribute("elementType");this.callbacks.setMusicList(elementId,elementType)}Animations.fadeDouble(leftSvgOverlay,leftOverlay,(()=>{}))}))}));const shareButtons=document.querySelectorAll(".btn-clickable-share");shareButtons.forEach((button=>{const rightOverlay=button.querySelector(".btn-overlay-img-right");const rightSvgOverlay=button.querySelector(".btn-overlay-img-right-svg");const tooltip=document.createElement("div");tooltip.className="tooltip";tooltip.innerText="Link copiato";button.appendChild(tooltip);const clipboard=new ClipboardJS(button,{text:function(){return button.getAttribute("data-clipboard-text")}});clipboard.on("success",(function(){tooltip.style.opacity=1;setTimeout((()=>{tooltip.style.opacity=0}),3e3)}));button.addEventListener("click",(event=>{event.stopPropagation();Animations.fadeDouble(rightOverlay,rightSvgOverlay,(()=>{Animations.fadeOut(3e3,tooltip,(()=>{}))}))}))}))}}innerHTML(){return`\n            <div class="slideshow-container">\n                <div class="container-swiper">\n                    <div class="swiper-container" id="${this.swiperId}">\n                        <div class="swiper-wrapper">\n                            ${this.swiperElementInnerHTML(this.obj)}\n                        </div>\n                    </div>\n                </div>\n            </div>\n        `}}class SearchBar{constructor(selector,callbacks){this.input=document.querySelector(selector);this.callbacks=callbacks;this.isSearched=false;this.checkSearched=false;this.searchText=""}setInput=value=>{this.input.value=value;this.searchText=`${value}`};init(){const setListeners=()=>{const checkInput=()=>{if(this.input.value==""||this.input.value.trim()===""){this.input.classList.add("blinking-border");this.input.style.borderLeft="2px solid rgb(128,128,128,1)"}else{this.input.classList.remove("blinking-border");this.input.style.borderLeft="none"}};const handleInputChange=()=>{const callBackInputChange=async callback=>{if(!this.isSearched){this.isSearched=true;this.checkSearched=false;try{await callback()}catch(error){console.log(error)}finally{this.isSearched=false;this.checkSearched=true}}};this.searchText=this.input.value;callBackInputChange(this.callbacks.onChange)};checkInput();this.input.addEventListener("input",checkInput.bind(this));this.input.addEventListener("change",checkInput.bind(this));this.input.addEventListener("input",handleInputChange.bind(this))};setListeners()}}class TimingBar{constructor(id,callbacks){this.id=id;this.progressBar=document.getElementById(this.id);this.width=0;this.duration=100;this.interval=null;this.isPlaying=false;this.callbacks=callbacks||{};this.init()}setDuration(duration){this.duration=duration;this.progressBar.max=this.duration}setDisabled(state){this.progressBar.disabled=state;this.progressBar.style.display=state?"none":"block"}init(){this.progressBar.addEventListener("input",(()=>{this.width=parseInt(this.progressBar.value);this.updateProgressBarStyle();if(this.callbacks.onChange){this.callbacks.onChange(this.id,this.progressBar.value)}if(this.isPlaying){this.stopInterval();this.startInterval()}}));this.progressBar.max=this.duration;this.updateProgressBarStyle()}setValue(value){this.progressBar.value=value;this.width=parseInt(this.progressBar.value);this.updateProgressBarStyle()}startInterval(){if(this.isPlaying&&this.interval===null){this.interval=setInterval((()=>{if(this.width>=this.duration){this.stopInterval()}else{this.width++;this.progressBar.value=this.width;this.updateProgressBarStyle()}}),1e3)}}stopInterval(){clearInterval(this.interval);this.interval=null}play(){if(!this.isPlaying){this.isPlaying=true;this.startInterval()}}pause(){if(this.isPlaying){this.isPlaying=false;this.stopInterval()}}updateProgressBarStyle(){let value=parseInt(this.progressBar.value);let max=parseInt(this.progressBar.max);let percent=value/max*100;this.progressBar.style.setProperty("--range-progress",percent+"%")}}class Footer{constructor(id){this.id=id}init=()=>{document.getElementById(this.id).innerHTML=this.innerHTML();this.setAnimations();this.setInitialTheme();this.changeTheme()};setAnimations=()=>{const goToTopSecond=document.getElementById("go-to-top-second");goToTopSecond.addEventListener("click",(()=>{Animations.fade(goToTopSecond,Constants.scrollTop)}));const goToTopFirst=document.getElementById("go-to-top-first");goToTopFirst.addEventListener("click",(()=>{Animations.fade(goToTopFirst,Constants.scrollTop)}))};setInitialTheme=()=>{const currentTheme=document.body.dataset.theme;const themeRadios=document.querySelectorAll('input[name="theme"]');themeRadios.forEach((radio=>{if(radio.value===currentTheme){radio.checked=true}}))};changeTheme=()=>{const themeRadios=document.querySelectorAll('input[name="theme"]');themeRadios.forEach((radio=>{radio.addEventListener("change",(()=>{if(radio.checked){const theme=radio.value;document.body.dataset.theme=theme;const favicon=document.querySelector('link[rel="icon"]');favicon.href=`./assets/images/favicon-${theme}.png`;fetch("config/session.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`theme=${encodeURIComponent(radio.value)}`}).catch((error=>{console.log(error)}))}}))}))};innerHTML=()=>`\n                <div class="footer">\n                    <div class="inner-footer">\n                        <div class="footer-start">\n                            © 2024\n                        </div>\n                        <div class="footer-start-second">\n                            <p class="footer-brand" id="go-to-top-second">   Music Player</p>   \n                        </div>\n                         <span class="footer-copyright-second">© 2024</span>\n                        <p class="footer-center"  id="go-to-top-first">\n                        Music Player\n                        </p>\n                        <div class="footer-end">\n                            <div class="toggle-container">\n                                <input type="radio" id="light" name="theme" value="light" checked>\n                                <label for="light">Light</label>\n                                <input type="radio" id="dark" name="theme" value="dark">\n                                <label for="dark">Dark</label>\n                                <div class="switch"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="footer-spacer"></div>\n            `}class Header{constructor(id){this.id=id}init=()=>{document.getElementById(this.id).innerHTML=this.innerHTML()};innerHTML=()=>`\n        <div class="brand-container">\n            <div class="brand">Music Player</div>\n        </div>\n    `}class Main{constructor(callbacks,isMusicSession){this.isMusicSession=isMusicSession;this.page="";this.callbacks=callbacks;this.isCreated=false;this.isLoaded=false;this.home=new Home("main",this.callbacksManager().home);this.artist=new Artist("main",this.callbacksManager().artist);this.music=new Music("main",this.callbacksManager().music)}init=async(page,elementId)=>new Promise((resolve=>{const lastPage=this.isMusicSession==true?"music":this.page;if(this.isMusicSession==true){this.isMusicSession=false}const initPage=async(page,elementId)=>{this.page=page;switch(this.page){case"home":document.title="MP · Home";this.stopAllWorkers(lastPage);this.home.init(lastPage);break;case"artist":document.title="MP · Artist";this.stopAllWorkers(lastPage);this.artist.init(elementId,this.isLoaded);break;case"music":this.stopAllWorkers(lastPage);document.title="MP · Music";this.music.init(elementId);break;default:break}this.callbacks.initNavbar(this.page)};const initNavbar=async()=>{this.callbacks.initNavbar(this.page)};const initialize=async(page,elementId)=>{await Promise.all([initPage(page,elementId),initNavbar()]);Constants.scrollTop()};initialize(page,elementId);resolve(true)}));stopAllWorkers=lastPage=>{switch(lastPage){case"music":this.music.stopAllWorkers();break;case"artist":this.artist.stopAllWorkers();break;case"home":this.home.stopAllWorkers();break;default:break}};updateMusic=(albumId,forceInx)=>{if(albumId==this.music.elementId){this.music.updateMusic(forceInx)}};callbacksManager=()=>{const callbacksHome=()=>{const goToPage=async(elementId,elementType)=>{switch(elementType){case"album":await this.init("music",elementId,this.isLoaded);break;case"artist":await this.init("artist",elementId,this.isLoaded);break;default:break}};const setMusicList=(elementId,elementType)=>{this.callbacks.setMusicList(elementId,elementType)};return{goToPage:goToPage,setMusicList:setMusicList}};const callbacksArtist=()=>{const goToPage=async(elementId,elementType)=>{switch(elementType){case"single":await this.init("music",elementId,this.isLoaded);break;case"album":await this.init("music",elementId,this.isLoaded);break;default:break}};const onlyPlay=albumId=>{this.callbacks.onlyPlay(albumId)};const onlyShuffle=albumId=>{this.callbacks.onlyShuffle(albumId)};const setMusicList=(elementId,elementType)=>{this.callbacks.setMusicList(elementId,elementType)};return{onlyPlay:onlyPlay,onlyShuffle:onlyShuffle,goToPage:goToPage,setMusicList:setMusicList}};const callbacksMusic=()=>{const getAlbumId=()=>this.callbacks.getAlbumId();const getIsPlaying=()=>this.callbacks.getIsPlaying();const getSingleId=()=>this.callbacks.getSingleId();const checkAvailableSong=()=>this.callbacks.checkAvailableSong();const togglePlay=(albumId,element)=>{this.callbacks.togglePlay(albumId,element)};const togglePlaySong=(albumId,songId)=>{this.callbacks.togglePlaySong(albumId,songId)};const shuffle=(albumId,element)=>{this.callbacks.shuffle(albumId,element)};const goToPage=(elementId,elementType)=>{this.callbacks.setMusicList(elementId,elementType)};const goToArtist=elementId=>{this.init("artist",elementId,this.isLoaded)};return{getAlbumId:getAlbumId,getIsPlaying:getIsPlaying,getSingleId:getSingleId,goToArtist:goToArtist,goToPage:goToPage,togglePlay:togglePlay,checkAvailableSong:checkAvailableSong,togglePlaySong:togglePlaySong,shuffle:shuffle}};return{home:callbacksHome(),artist:callbacksArtist(),music:callbacksMusic()}}}class Navbar extends WorkerManager{constructor(id,callbacks,albumId,singleId){super();this.opera;this.id=id;this.callbacks=callbacks;this.timingBar;this.timingBarSmall;this.albumIcon;this.explicitSong;this.songName;this.songInfo;this.albumIconSmall;this.explicitSongSmall;this.songNameSmall;this.songInfoSmall;this.navSongSvg;this.navSongSvgSmall;this.isActive=false;this.isProcessing=false;this.icons;this.iconIds;this.navbarCenterElement;this.navbarCenterElementSmall;this.isDownloading=false;this.isClickable=false;this.isShuffle=false;this.isRepeat=false;this.contentCenter;this.contentCenterSmall;this.progressBar;this.progressBarSmall;this.albumId=albumId;this.singleId=singleId;this.audioArray=[];this.currentIndex=0;this.isPlaying=false;this.isToggleClicked=false;this.isFirstToggleShuffle=true;this.isFirstLoad=true;this.appIsExplicit=-1;this.lastAlbumId=-1;this.startAudio=new Audio("../../../../MusicPlayer/Client/assets/audios/test.mp3");this.systemData=this.getSystemData()}createStickyNavbar(elementId,stickyClass){var navbar=document.getElementById(elementId);var sticky=navbar.offsetTop;function stickyNavbar(){if(window.pageYOffset>sticky){navbar.classList.add(stickyClass)}else{navbar.classList.remove(stickyClass)}}window.onscroll=function(){stickyNavbar()}}setMusicData=(albumId,singleId)=>{this.albumId=albumId;this.singleId=singleId;this.fetchData()};getIsPlaying=()=>this.isPlaying;initOpera=()=>{const musics=[];musics.push({name:"",collabs:"",url:"",isExplicit:false,isHover:false,isPlaying:false,id:-1});return{prodotto:{image:"",author:"",id:-1},canzoni:musics}};getIsPc=()=>{const platform=navigator.platform;const isWindows=/Windows/.test(platform);const isMac=/Mac/.test(platform);const os=isWindows?"Windows":isMac?"macOS":"";return os};getSystemData(){const userAgent=navigator.userAgent;const platform=navigator.platform;const isChrome=/Chrome/.test(userAgent)&&/Google Inc/.test(navigator.vendor)&&!/OPR/.test(userAgent)&&!/Edg/.test(userAgent);const isEdge=/Edg/.test(userAgent)||/Edge/.test(userAgent);const isFirefox=/Firefox/.test(userAgent);const isOpera=/OPR/.test(userAgent)||/Opera/.test(userAgent);const isSafari=/Safari/.test(userAgent)&&!/Chrome/.test(userAgent)&&!/OPR/.test(userAgent)&&!/Edg/.test(userAgent);const isWindows=/Windows/.test(platform);const isMac=/Mac/.test(platform);const isAndroid=/Android/.test(userAgent);const isIOS=/iPad|iPhone|iPod/.test(userAgent)&&!window.MSStream;const browser=isChrome?"Chrome":isEdge?"Edge":isFirefox?"Firefox":isOpera?"Opera":isSafari?"Safari":"";const os=isWindows?"Windows":isMac?"macOS":isAndroid?"Android":isIOS?"iOS":"";switch(os){case"macOS":case"Windows":switch(browser){case"Chrome":case"Edge":case"Opera":return 1;case"Firefox":return 2;default:return-1}default:return-1}}getMimeTypeFromExtension(url){const extension=url.split(".").pop().toLowerCase();switch(extension){case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";case"gif":return"image/gif";case"webp":return"image/webp";case"svg":return"image/svg+xml";default:return"image/jpeg"}}rotateImage90DegreesRight(imageUrl){return new Promise(((resolve,reject)=>{const img=new Image;img.crossOrigin="Anonymous";img.onload=()=>{const canvas=document.createElement("canvas");const ctx=canvas.getContext("2d");canvas.width=img.height;canvas.height=img.width;ctx.translate(canvas.width/2,canvas.height/2);ctx.rotate(0);ctx.drawImage(img,-img.width/2,-img.height/2);const rotatedImageUrl=canvas.toDataURL("image/png");resolve(rotatedImageUrl)};img.onerror=error=>{reject(error)};img.src=imageUrl}))}setParams=async(title,artist,album,imageUrl)=>{if("mediaSession"in navigator){const mimeType=this.getMimeTypeFromExtension(imageUrl);const image=this.systemData===1&&imageUrl!=="./assets/images/song.png"?await this.rotateImage90DegreesRight(imageUrl):imageUrl;navigator.mediaSession.metadata=new MediaMetadata({title:title,artist:artist,album:album,artwork:[{src:image,sizes:"512x512",type:mimeType}]});navigator.mediaSession.setActionHandler("play",(async()=>{if(this.audioArray.length===0)return;this.isPlaying=true;this.audioArray[this.currentIndex].play();this.audioArray[this.currentIndex].playbackRate=1;this.timingBar.play();this.timingBarSmall.play();this.callbacks.updateMusic(-1);this.clickPlayFill()}));navigator.mediaSession.setActionHandler("pause",(async()=>{if(this.audioArray.length===0)return;this.isPlaying=false;const pc=this.getIsPc();if(pc=="macOS"||pc=="Windows"){this.audioArray[this.currentIndex].pause()}else{this.audioArray[this.currentIndex].playbackRate=0}this.timingBar.pause();this.timingBarSmall.pause();this.callbacks.updateMusic(-1);this.clickPlayFill()}));navigator.mediaSession.setActionHandler("previoustrack",(async()=>{if(this.audioArray.length===0)return;this.audioArray.forEach((audio=>{audio.pause();audio.currentTime=0}));if(this.isShuffle){this.currentIndex=Math.floor(Math.random()*this.audioArray.length)}else{this.currentIndex=this.currentIndex>0?this.currentIndex-1:this.audioArray.length-1}this.setMusicData(this.opera.prodotto.id,this.opera.canzoni[this.currentIndex].id);const result=await this.fetchOneAudioWorker(this.opera.canzoni[this.currentIndex].url,this.currentIndex);await this.setParams(this.opera.canzoni[this.currentIndex].name,this.opera.prodotto.author,this.opera.canzoni.length===1?"Singolo":this.opera.prodotto.title,this.opera.prodotto.image);if(!this.isPlaying){this.isPlaying=true;this.clickPlayFill()}this.audioArray[this.currentIndex].play();this.audioArray[this.currentIndex].volume=this.progressBar.value/100;this.timingBar.play();this.timingBarSmall.play();Animations.fade(this.contentCenter,(()=>this.secondLoad(result)));Animations.fade(this.contentCenterSmall,(()=>this.secondLoadSmall(result)));this.callbacks.updateMusic(-1)}));navigator.mediaSession.setActionHandler("nexttrack",(async()=>{if(this.audioArray.length===0)return;this.audioArray.forEach((audio=>{audio.pause();audio.currentTime=0}));if(this.isShuffle){this.currentIndex=Math.floor(Math.random()*this.audioArray.length)}else{this.currentIndex=this.currentIndex<this.audioArray.length-1?this.currentIndex+1:0}this.setMusicData(this.opera.prodotto.id,this.opera.canzoni[this.currentIndex].id);const result=await this.fetchOneAudioWorker(this.opera.canzoni[this.currentIndex].url,this.currentIndex);await this.setParams(this.opera.canzoni[this.currentIndex].name,this.opera.prodotto.author,this.opera.canzoni.length===1?"Singolo":this.opera.prodotto.title,this.opera.prodotto.image);if(!this.isPlaying){this.isPlaying=true;this.clickPlayFill()}this.audioArray[this.currentIndex].play();this.audioArray[this.currentIndex].volume=this.progressBar.value/100;this.timingBar.play();this.timingBarSmall.play();Animations.fade(this.contentCenter,(()=>this.secondLoad(result)));Animations.fade(this.contentCenterSmall,(()=>this.secondLoadSmall(result)));this.callbacks.updateMusic(-1)}));const updatePosition=()=>{const playbackRate=this.audioArray[this.currentIndex].playbackRate;if(playbackRate>0){navigator.mediaSession.setPositionState({duration:this.audioArray[this.currentIndex].duration,playbackRate:playbackRate,position:this.audioArray[this.currentIndex].currentTime})}};if(this.audioArray.length!=0){this.audioArray[this.currentIndex].addEventListener("timeupdate",updatePosition)}}};setOpera=obj=>{const musics=obj.canzoni.map((canzone=>({name:canzone.name,collabs:canzone.collabs,url:canzone.url,isExplicit:canzone.isExplicit,isHover:false,isPlaying:false,id:canzone.id})));return{prodotto:{image:obj.prodotto.image,author:obj.prodotto.author,id:obj.prodotto.id,title:obj.prodotto.title},canzoni:musics}};initProgressbar(progressBar,callback){function updateProgress(){const value=progressBar.value;callback(value);progressBar.style.setProperty("--range-progress",`${value}%`);progressBar.style.setProperty("--thumb-position",`${value}%`);const otherProgressBar=progressBar.id==="progress-bar"?document.getElementById("progress-bar-small"):document.getElementById("progress-bar");if(otherProgressBar){otherProgressBar.value=value;otherProgressBar.style.setProperty("--range-progress",`${value}%`);otherProgressBar.style.setProperty("--thumb-position",`${value}%`)}}progressBar.addEventListener("input",(()=>{const value=progressBar.value;progressBar.style.setProperty("--range-progress",`${value}%`);progressBar.style.setProperty("--thumb-position",`${value}%`)}));progressBar.addEventListener("change",updateProgress)}animationOnCallback=(newText,callback)=>{document.getElementById("dynamic-bar").innerHTML=newText;callback()};setupDynamicbar=(currentText,newText,callback)=>{document.getElementById("dynamic-bar").innerHTML=currentText;document.getElementById("dynamic-bar").addEventListener("click",(()=>{Animations.fade(document.getElementById("dynamic-bar"),(()=>{this.animationOnCallback(newText,callback)}))}))};setProgressBar=(progressBar,value)=>{progressBar.style.setProperty("--range-progress",`${value}%`);progressBar.style.setProperty("--thumb-position",`${value}%`);progressBar.value=value};callbacksManager=()=>{const progressBar=()=>{const onChange=(id,value)=>{this.setTime(value);if(id=="timing-bar"){this.timingBarSmall.setValue(value);this.timingBarSmall.updateProgressBarStyle()}else{this.timingBar.setValue(value);this.timingBar.updateProgressBarStyle()}};return{onChange:onChange}};return{progressBar:progressBar()}};loadPlay=()=>{this.audioArray[this.currentIndex].play();this.isPlaying=true;this.forceTogglePlay(this.icons["play-fill-icon"],this.timingBar);this.forceTogglePlay(this.icons["play-fill-icon-small"],this.timingBarSmall)};doPlay=()=>{this.audioArray[this.currentIndex].play();this.isPlaying=true};doStop=()=>{this.audioArray[this.currentIndex].pause();this.isPlaying=false;this.timingBarSmall.setValue(0);this.timingBar.setValue(0);this.audioArray[this.currentIndex].pause();this.audioArray[this.currentIndex].currentTime=0};loadPause=()=>{this.audioArray[this.currentIndex].pause();this.isPlaying=false;this.forceTogglePause(this.icons["play-fill-icon"],this.timingBar);this.forceTogglePause(this.icons["play-fill-icon-small"],this.timingBarSmall)};play=()=>{if(!this.isPlaying){this.audioArray[this.currentIndex].play();this.isPlaying=true}};forcePlay=()=>{this.audioArray[this.currentIndex].play();this.isPlaying=true};setVolume=volume=>{if(this.isProcessing||this.audioArray==[]){return}else{this.isProcessing=true;if(this.currentIndex>=0&&this.currentIndex<this.audioArray.length){const audio=this.audioArray[this.currentIndex];if(audio){audio.volume=volume}}setTimeout((()=>{this.isProcessing=false}),300)}};pause(){if(this.isPlaying){this.audioArray[this.currentIndex].pause();this.isPlaying=false}}setTime(seconds){if(this.audioArray[this.currentIndex]){this.audioArray[this.currentIndex].currentTime=seconds}}async next(state){if(this.isProcessing){return}else{this.prepareDoPreviousOrNext();if(this.isShuffle){this.currentIndex=Math.floor(Math.random()*this.audioArray.length)}else if(!this.isRepeat&&!state){if(this.currentIndex<this.audioArray.length-1){this.currentIndex++}else{this.currentIndex=0}}await this.doPreviousOrNext()}}async previous(){if(this.isProcessing){return}else{this.prepareDoPreviousOrNext();if(this.isShuffle){this.currentIndex=Math.floor(Math.random()*this.audioArray.length)}else{if(this.currentIndex>0){this.currentIndex--}else{this.currentIndex=this.audioArray.length-1}}this.doPreviousOrNext()}}prepareDoPreviousOrNext=()=>{this.stopAllWorkers();this.resetWorkers();this.isProcessing=true;this.timingBarSmall.setValue(0);this.timingBar.setValue(0);this.audioArray[this.currentIndex].pause();this.audioArray[this.currentIndex].currentTime=0;this.timingBar.pause();this.timingBarSmall.pause();this.isActive=false;this.setCursor(false);this.progressBar.disabled=true;this.progressBarSmall.disabled=true;this.timingBar.progressBar.disabled=true;this.timingBarSmall.progressBar.disabled=true;this.isDownloading=true};doPreviousOrNext=async()=>{await this.fetchData();this.setMusicData(this.opera.prodotto.id,this.opera.canzoni[this.currentIndex].id);this.waitingNavbarSecond(this.opera.prodotto.image);await new Promise((resolve=>setTimeout(resolve,500)));this.fetchOneAudioWorker(this.opera.canzoni[this.currentIndex].url,this.currentIndex).then((result=>{if(this.isPlaying){this.audioArray[this.currentIndex].play();this.timingBar.play();this.timingBarSmall.play()}this.isActive=true;this.setCursor(true);this.progressBar.disabled=false;this.progressBarSmall.disabled=false;this.timingBar.progressBar.disabled=false;this.timingBarSmall.progressBar.disabled=false;const duration=result;this.audioArray[this.currentIndex].volume=this.progressBar.value/100;this.timingBar.setDuration(duration);this.timingBarSmall.setDuration(duration);Animations.fade(this.contentCenter,(()=>{this.songInfo.innerHTML=`${this.opera.prodotto.author} - ${this.opera.canzoni[this.currentIndex].collabs!=""?`${this.opera.canzoni[this.currentIndex].collabs}`:"Single"}`;this.songName.innerHTML=this.opera.canzoni[this.currentIndex].name;this.timingBar.setDisabled(false)}));Animations.fade(this.contentCenterSmall,(()=>{this.songInfoSmall.innerHTML=`${this.opera.prodotto.author} - ${this.opera.canzoni[this.currentIndex].collabs!=""?`${this.opera.canzoni[this.currentIndex].collabs}`:"Single"}`;this.songNameSmall.innerHTML=this.opera.canzoni[this.currentIndex].name;this.timingBarSmall.setDisabled(false)}));this.setParams(this.opera.canzoni[this.currentIndex].name,this.opera.prodotto.author,this.opera.canzoni.length==1?"Singolo":this.opera.prodotto.title,this.opera.prodotto.image);this.callbacks.updateMusic(-1);setTimeout((()=>{this.isDownloading=false;this.isProcessing=false}),700)})).catch((error=>{console.error("Error during audio processing:",error);this.isProcessing=false;return}))};stop(){if(this.isPlaying){this.audioArray[this.currentIndex].pause();this.audioArray[this.currentIndex].currentTime=0;this.isPlaying=false}}initNavbar=data=>{this.opera=this.setOpera(data);for(let i=0;i<this.opera.canzoni.length;i++){if(this.opera.canzoni[i].id==this.singleId){this.currentIndex=i}}this.initAudioArray();this.fetchData();this.setMusicData(this.opera.prodotto.id,this.opera.canzoni[this.currentIndex].id)};initAudioArray=()=>{this.audioArray=this.opera.canzoni.map((canzone=>new Audio(canzone.url)));this.audioArray.forEach((audio=>{audio.addEventListener("ended",(async()=>{await this.next(true);this.setParams(this.opera.canzoni[this.currentIndex].name,this.opera.prodotto.author,this.opera.canzoni.length==1?"Singolo":this.opera.prodotto.title,this.opera.prodotto.image)}))}))};updateNavbar=data=>{this.opera=this.setOpera(data);this.initAudioArray();this.currentIndex=0;this.fetchData()};startPlayback=()=>{this.startAudio.play().then((()=>{this.setParams("Nessun brano in riproduzione","","","./assets/images/song.png","image/png");setTimeout((()=>{this.startAudio.pause();this.startAudio.currentTime=0}),50);document.removeEventListener("click",this.startPlayback)})).catch((error=>{console.error("Errore durante l'avvio della riproduzione:",error)}))};init=async(currentText,newText,callback)=>{document.getElementById(this.id).innerHTML=this.innerHTML();this.createStickyNavbar(this.id,"sticky-navbar");this.progressBar=document.getElementById("progress-bar");this.progressBarSmall=document.getElementById("progress-bar-small");if(this.albumId==-1){this.opera=this.initOpera()}else{await this.fetchWorker("getMusicMin",{elementId:this.albumId},this.initNavbar)}this.timingBar=new TimingBar("timing-bar",this.callbacksManager().progressBar);this.timingBarSmall=new TimingBar("timing-bar-small",this.callbacksManager().progressBar);this.albumIcon=document.getElementById("nav-album-icon");this.explicitSong=document.getElementById("navbar-explicit-song");this.songName=document.getElementById("song-name");this.songInfo=document.getElementById("song-info");this.navSongSvg=document.getElementById("nav-song-svg");this.navSongSvgSmall=document.getElementById("nav-song-svg-small");this.albumIconSmall=document.getElementById("nav-album-icon-small");this.explicitSongSmall=document.getElementById("navbar-explicit-song-small");this.songNameSmall=document.getElementById("song-name-small");this.songInfoSmall=document.getElementById("song-info-small");this.navbarCenterElement=document.getElementById("navbar-center-elem");this.navbarCenterElementSmall=document.getElementById("navbar-center-elem-small");this.contentCenter=document.getElementById("content-center");this.contentCenterSmall=document.getElementById("content-center-small");this.iconIds=["nav-album-icon","nav-album-icon-small","shuffle-icon","skip-backward-icon","play-fill-icon","skip-forward-icon","repeat-icon","volume-off-fill-icon","volume-up-fill-icon","shuffle-icon-small","skip-backward-icon-small","play-fill-icon-small","skip-forward-icon-small","repeat-icon-small","volume-off-fill-icon-small","volume-up-fill-icon-small"];this.icons=this.iconIds.reduce(((acc,id)=>{const element=document.getElementById(id);acc[id]=element;return acc}),{});this.setProgressBar(this.progressBar,70);this.setProgressBar(this.progressBarSmall,70);this.initProgressbar(this.progressBar,(value=>{this.setVolume(value/100)}));this.initProgressbar(this.progressBarSmall,(value=>{this.setVolume(value/100)}));this.setupDynamicbar(currentText,newText,callback);this.setAnimations();if(this.albumId==-1){this.isDownloading=false;this.inactiveNavbar();document.addEventListener("click",this.startPlayback,{once:true})}else{this.lastAlbumId=this.opera.prodotto.id;this.isDownloading=true;this.waitingNavbarStart(this.opera.prodotto.image);this.setCurrentIndexSong(this.singleId);await new Promise((resolve=>setTimeout(resolve,500)));this.fetchOneAudioWorker(this.opera.canzoni[this.currentIndex].url,this.currentIndex).then((result=>{if(this.terminated)return;this.activeNavbar(result);setTimeout((()=>{this.isDownloading=false}),700)})).catch((error=>{console.error("Error during audio processing:",error)}))}};setCursor(stato){this.iconIds.forEach((id=>{const element=this.icons[id];if(element){element.style.cursor=stato?"pointer":"default"}}))}toggleVolume(value){[this.progressBar,this.progressBarSmall].forEach((bar=>{if(bar){bar.value=value;bar.style.setProperty("--range-progress",`${value}%`)}}))}toggleRepetitionMode(btnShuffle,btnRepeat,state,stateForceShuffle,stateOperation){return()=>{if(this.isProcessing&&stateForceShuffle==false){return}else{const[activeBtn,inactiveBtn]=state?[btnShuffle,btnRepeat]:[btnRepeat,btnShuffle];if(activeBtn.classList.contains("icon-active")){activeBtn.classList.remove("icon-active");this.isShuffle=false;this.isRepeat=false}else{activeBtn.classList.add("icon-active");if(inactiveBtn.classList.contains("icon-active")){Animations.fade(inactiveBtn,(()=>{inactiveBtn.classList.remove("icon-active")}))}else{inactiveBtn.classList.remove("icon-active")}if(stateOperation==true){if(activeBtn===btnShuffle){this.isShuffle=true;this.isRepeat=false}else{this.isShuffle=false;this.isRepeat=true}}}}setTimeout((()=>{this.isProcessing=false}),300)}}forceTogglePause=(svgElement,progressBarInstance)=>{const forcePlayCallback=(svgElement,progressBarInstance)=>()=>{const newPath="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393";svgElement.querySelector("path").setAttribute("d",newPath);progressBarInstance.isPlaying=false;progressBarInstance.startInterval();svgElement.setAttribute("width","16");svgElement.setAttribute("height","16");svgElement.setAttribute("viewBox","0 0 16 16")};Animations.fade(svgElement,forcePlayCallback(svgElement,progressBarInstance))};forceTogglePauseSecond=(svgElement,progressBarInstance)=>{const forcePlayCallback=(svgElement,progressBarInstance)=>()=>{const newPath="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393";svgElement.querySelector("path").setAttribute("d",newPath);progressBarInstance.isPlaying=false;progressBarInstance.startInterval();svgElement.setAttribute("width","16");svgElement.setAttribute("height","16");svgElement.setAttribute("viewBox","0 0 16 16")};forcePlayCallback(svgElement,progressBarInstance)};forceTogglePlaySecond=(svgElement,progressBarInstance)=>{const forcePlayCallback=(svgElement,progressBarInstance)=>()=>{const newPath="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5m5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5";svgElement.querySelector("path").setAttribute("d",newPath);progressBarInstance.isPlaying=true;progressBarInstance.startInterval();svgElement.setAttribute("width","16");svgElement.setAttribute("height","16");svgElement.setAttribute("viewBox","0 0 16 16")};forcePlayCallback(svgElement,progressBarInstance)};forceTogglePlay=(svgElement,progressBarInstance)=>{const forcePlayCallback=(svgElement,progressBarInstance)=>()=>{const newPath="M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5m5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5";svgElement.querySelector("path").setAttribute("d",newPath);progressBarInstance.isPlaying=true;progressBarInstance.startInterval();svgElement.setAttribute("width","16");svgElement.setAttribute("height","16");svgElement.setAttribute("viewBox","0 0 16 16")};Animations.fade(svgElement,forcePlayCallback(svgElement,progressBarInstance))};togglePlayCallback=async albumId=>{if(this.isDownloading==false&&this.isToggleClicked==false){this.isDownloading=true;this.isToggleClicked=true;for(let i=0;i<this.audioArray.length;i++){this.audioArray[i].pause();this.audioArray[i].currentTime=0}if(albumId!=this.albumId){this.albumId=albumId;await this.changeNavbar(this.albumId,-1).then((()=>{if(this.isPlaying==false){this.loadPlay()}else{this.audioArray[this.currentIndex].play();this.isPlaying=true}}))}else{this.changeNavbarSecond(-1).then((()=>{if(this.isPlaying==false){this.loadPlay()}else{this.audioArray[this.currentIndex].play();this.isPlaying=true}}))}const isPlayingApp=this.isPlaying;this.isPlaying=true;this.callbacks.updateMusic(0);this.isPlaying=isPlayingApp;setTimeout((()=>{this.isDownloading=false;this.isToggleClicked=false}),1e3)}};setCurrentIndexSong=songId=>{for(let i=0;i<this.opera.canzoni.length;i++){if(this.opera.canzoni[i].id==songId){this.currentIndex=i;break}}};setMusicList=elementId=>{if(this.isDownloading==false){if(elementId!=this.opera.prodotto.id){this.isDownloading=true;this.stop();this.changeNavbar(elementId).then((()=>{if(document.getElementById("play-fill-icon").innerHTML.trim()==`<path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"></path>`){this.loadPlay()}else{this.play()}setTimeout((()=>{this.isDownloading=false}),700)}))}else{this.stop();this.timingBar.setValue(0);this.timingBarSmall.setValue(0);if(document.getElementById("play-fill-icon").innerHTML.trim()==`<path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"></path>`){this.loadPlay()}else{this.play()}}}};getCurrentIndexSong=songId=>{for(let i=0;i<this.opera.canzoni.length;i++){if(this.opera.canzoni[i].id==songId){return i}}};toggleShuffle=async albumId=>{let stateUpdateMusic=false;if(this.isDownloading==false&&this.isToggleClicked==false){this.isDownloading=true;this.isToggleClicked=true;for(let i=0;i<this.audioArray.length;i++){this.audioArray[i].pause();this.audioArray[i].currentTime=0}if(albumId!=this.albumId){this.albumId=albumId;await this.changeNavbar(this.albumId,-2);stateUpdateMusic=true}else{await this.next(true);this.animateExplicitSong(this.explicitSong);this.appIsExplicit=this.animateExplicitSong(this.explicitSongSmall)}if(this.isShuffle==false){if(this.icons["shuffle-icon"]){Animations.fade(this.icons["shuffle-icon"],this.toggleRepetitionMode(this.icons["shuffle-icon"],this.icons["repeat-icon"],true,true,true))}if(this.icons["shuffle-icon-small"]){Animations.fade(this.icons["shuffle-icon-small"],this.toggleRepetitionMode(this.icons["shuffle-icon-small"],this.icons["repeat-icon-small"],true,true,true))}}if(this.isPlaying==false){this.loadPlay()}else{this.forcePlay()}if(this.isFirstToggleShuffle==true){this.isFirstToggleShuffle=false}if(stateUpdateMusic==true){this.callbacks.updateMusic(-1)}setTimeout((()=>{this.isDownloading=false;this.isToggleClicked=false}),1e3)}};checkAvailableSong=()=>this.isDownloading==false&&this.isToggleClicked==false;togglePlaySong=async(albumId,songId)=>{this.lastAlbumId=this.albumId;if(this.isDownloading==false&&this.isToggleClicked==false){this.isDownloading=true;this.isToggleClicked=true;for(let i=0;i<this.audioArray.length;i++){this.audioArray[i].pause();this.audioArray[i].currentTime=0}if(albumId!=this.albumId){this.albumId=albumId;await this.changeNavbar(this.albumId,songId).then((()=>{if(this.isPlaying==false){this.loadPlay()}else{this.audioArray[this.currentIndex].play();this.isPlaying=true}}))}else{this.setMusicData(this.opera.prodotto.id,songId);if(this.getCurrentIndexSong(songId)==this.currentIndex){if(this.isPlaying==false){this.loadPlay()}else{this.timingBar.pause();this.timingBarSmall.pause();this.loadPause()}}else{this.changeNavbarSecond(songId).then((()=>{if(this.isPlaying==false){this.loadPlay()}else{this.audioArray[this.currentIndex].play();this.isPlaying=true}}))}}setTimeout((()=>{this.isDownloading=false;this.isToggleClicked=false}),1e3)}};clickPlayFill=async()=>{const playCallback=(svgElement,progressBarInstance)=>new Promise((resolve=>{const[newPath1,newPath2]=["M5.5 3.5A1.5 1.5 0 0 1 7 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5m5 0A1.5 1.5 0 0 1 12 5v6a1.5 1.5 0 0 1-3 0V5a1.5 1.5 0 0 1 1.5-1.5","m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"];const currentPath=svgElement.querySelector("path").getAttribute("d");const newPath=currentPath===newPath1?newPath2:newPath1;svgElement.querySelector("path").setAttribute("d",newPath);if(newPath===newPath1){this.play();progressBarInstance.isPlaying=true;progressBarInstance.startInterval();this.audioArray[this.currentIndex].playbackRate=1}else{this.pause();progressBarInstance.isPlaying=false;progressBarInstance.stopInterval()}svgElement.setAttribute("width","16");svgElement.setAttribute("height","16");svgElement.setAttribute("viewBox","0 0 16 16");resolve()}));const togglePlay=async(svgElement,progressBarInstance)=>{await new Promise((resolve=>{Animations.fade(svgElement,(async()=>{await playCallback(svgElement,progressBarInstance);resolve()}))}))};if(this.icons["play-fill-icon"]){if(this.isActive){await togglePlay(this.icons["play-fill-icon"],this.timingBar)}}if(this.icons["play-fill-icon-small"]){if(this.isActive){await togglePlay(this.icons["play-fill-icon-small"],this.timingBarSmall)}}if(this.isActive){this.callbacks.updateMusic(-1)}};setAnimations=()=>{const iconsMethods={"play-fill-method":async()=>{this.clickPlayFill()},"nav-album-method":()=>{if(this.isClickable){const iconsToFade=["nav-album-icon","nav-album-icon-small"];iconsToFade.forEach((iconName=>{const icon=this.icons[iconName];if(icon){Animations.fade(icon,(()=>{}))}}));this.callbacks.goToMusic(this.opera.prodotto.id)}},"shuffle-method":()=>{if(this.icons["shuffle-icon"]){if(this.isActive){Animations.fade(this.icons["shuffle-icon"],this.toggleRepetitionMode(this.icons["shuffle-icon"],this.icons["repeat-icon"],true,false,false))}}if(this.icons["shuffle-icon-small"]){if(this.isActive){Animations.fade(this.icons["shuffle-icon-small"],this.toggleRepetitionMode(this.icons["shuffle-icon-small"],this.icons["repeat-icon-small"],true,false,false))}}},"skip-backward-method":()=>{if(this.icons["skip-backward-icon"]){if(this.isActive){Animations.fade(this.icons["skip-backward-icon"],(async()=>await this.previous()))}}if(this.icons["skip-backward-icon-small"]){if(this.isActive){Animations.fade(this.icons["skip-backward-icon-small"],(async()=>await this.previous()))}}},"skip-forward-method":()=>{if(this.icons["skip-forward-icon"]){if(this.isActive){Animations.fade(this.icons["skip-forward-icon"],(async()=>await this.next(false)))}}if(this.icons["skip-forward-icon-small"]){if(this.isActive){Animations.fade(this.icons["skip-forward-icon-small"],(async()=>await this.next(false)))}}},"repeat-method":()=>{if(this.icons["repeat-icon"]){if(this.isActive){Animations.fade(this.icons["repeat-icon"],this.toggleRepetitionMode(this.icons["shuffle-icon"],this.icons["repeat-icon"],false,false,false))}}if(this.icons["repeat-icon-small"]){if(this.isActive){Animations.fade(this.icons["repeat-icon-small"],this.toggleRepetitionMode(this.icons["shuffle-icon-small"],this.icons["repeat-icon-small"],false,false,false))}}},"volume-off-fill-method":()=>{if(this.icons["volume-off-fill-icon"]){if(this.isActive){this.toggleVolume(0);this.setVolume(0);Animations.fade(this.icons["volume-off-fill-icon"],(()=>{}))}}if(this.icons["volume-off-fill-icon-small"]){if(this.isActive){this.toggleVolume(0);this.setVolume(0);Animations.fade(this.icons["volume-off-fill-icon-small"],(()=>{}))}}},"volume-up-fill-method":()=>{if(this.icons["volume-up-fill-icon"]){if(this.isActive){this.toggleVolume(100);this.setVolume(1);Animations.fade(this.icons["volume-up-fill-icon"],(()=>{}))}}if(this.icons["volume-up-fill-icon-small"]){if(this.isActive){this.toggleVolume(100);this.setVolume(1);Animations.fade(this.icons["volume-up-fill-icon-small"],(()=>{}))}}}};this.iconIds.forEach((id=>{const methodKey=id.replace(/-icon(-small)?/,"-method");if(this.icons[id]&&iconsMethods[methodKey]){this.icons[id].addEventListener("click",iconsMethods[methodKey])}}))};inactiveNavbar=()=>{this.isActive=false;this.setCursor(false);this.isClickable=false;this.progressBar.disabled=true;this.progressBarSmall.disabled=true;this.navbarCenterElement.style.display="flex";this.navbarCenterElementSmall.style.display="flex";this.firstLoad("Nessun brano in riproduzione");this.firstLoadSmall("Nessun brano in riproduzione")};activeNavbar=duration=>{if(this.lastAlbumId==-1){this.isFirstLoad=false;this.audioArray[this.currentIndex].play().then((()=>{if("mediaSession"in navigator){navigator.mediaSession.metadata=new MediaMetadata({title:this.opera.canzoni[this.currentIndex].name,artist:this.opera.prodotto.author,album:this.opera.prodotto.title,artwork:[{src:this.opera.prodotto.image,sizes:"96x96",type:"image/png"}]});const updatePosition=()=>{const playbackRate=this.audioArray[this.currentIndex].playbackRate;if(playbackRate>0){navigator.mediaSession.setPositionState({duration:this.audioArray[this.currentIndex].duration,playbackRate:playbackRate,position:this.audioArray[this.currentIndex].currentTime})}};this.audioArray[this.currentIndex].addEventListener("timeupdate",updatePosition)}}))}else{if(this.isFirstLoad==true){this.isFirstLoad=false;const startPlayback=()=>{this.audioArray[this.currentIndex].play().then((()=>{this.doPlay();this.setParams(this.opera.canzoni[this.currentIndex].name,this.opera.prodotto.author,this.opera.canzoni.length==1?"Singolo":this.opera.prodotto.title,this.opera.prodotto.image);this.doStop();document.removeEventListener("click",startPlayback)})).catch((error=>{console.error("Errore durante l'avvio della riproduzione:",error)}))};document.addEventListener("click",startPlayback,{once:true})}else{if(this.isPlaying){this.setParams(this.opera.canzoni[this.currentIndex].name,this.opera.prodotto.author,this.opera.canzoni.length==1?"Singolo":this.opera.prodotto.title,this.opera.prodotto.image)}}}this.isActive=true;this.setCursor(true);this.isClickable=true;this.progressBar.disabled=false;this.progressBarSmall.disabled=false;this.navbarCenterElement.style.display="flex";this.navbarCenterElementSmall.style.display="flex";Animations.fade(this.contentCenter,(()=>{this.secondLoad(duration)}));Animations.fade(this.contentCenterSmall,(()=>{this.secondLoadSmall(duration)}))};waitingNavbarStart=imageURL=>{this.isActive=false;this.setCursor(false);this.isClickable=true;this.progressBar.disabled=true;this.progressBarSmall.disabled=true;this.navbarCenterElement.style.display="flex";this.navbarCenterElementSmall.style.display="flex";this.waitingLoad(imageURL);this.waitingLoadSmall(imageURL)};waitingNavbarSecond=imageURL=>{this.isActive=false;this.setCursor(false);this.isClickable=true;this.progressBar.disabled=true;this.progressBarSmall.disabled=true;this.navbarCenterElement.style.display="flex";this.navbarCenterElementSmall.style.display="flex";Animations.fade(this.contentCenter,(()=>{this.waitingLoad(imageURL)}));Animations.fade(this.contentCenterSmall,(()=>{this.waitingLoadSmall(imageURL)}))};waitingNavbar=imageURL=>{this.isActive=false;this.setCursor(false);this.isClickable=true;this.progressBar.disabled=true;this.progressBarSmall.disabled=true;this.navbarCenterElement.style.display="flex";this.navbarCenterElementSmall.style.display="flex";Animations.fade(this.navbarCenterElement,(()=>{this.waitingLoad(imageURL)}));Animations.fade(this.navbarCenterElementSmall,(()=>{this.waitingLoadSmall(imageURL)}))};changeNavbar=async(albumId,songId)=>{this.stopAllWorkers();this.resetWorkers();await this.fetchWorker("getMusicMin",{elementId:albumId},this.updateNavbar);if(songId==-1){this.currentIndex=0}else if(songId==-2){this.currentIndex=Math.floor(Math.random()*this.opera.canzoni.length)}else{this.setCurrentIndexSong(songId)}this.setMusicData(this.opera.prodotto.id,this.opera.canzoni[this.currentIndex].id);this.waitingNavbar(this.opera.prodotto.image);await new Promise((resolve=>setTimeout(resolve,500)));this.fetchOneAudioWorker(this.opera.canzoni[this.currentIndex].url,this.currentIndex).then((result=>{if(this.terminated)return;this.activeNavbar(result)})).catch((error=>{console.error("Error during audio processing:",error)}))};changeNavbarSecond=async songId=>{this.waitingNavbarSecond(this.opera.prodotto.image);await new Promise((resolve=>setTimeout(resolve,500)));if(songId==-1){this.currentIndex=0}else{this.setCurrentIndexSong(songId)}this.setMusicData(this.opera.prodotto.id,this.opera.canzoni[this.currentIndex].id);this.fetchOneAudioWorker(this.opera.canzoni[this.currentIndex].url,this.currentIndex).then((result=>{if(this.terminated)return;this.activeNavbar(result)})).catch((error=>{console.error("Error during audio processing:",error)}))};animateExplicitSong=element=>{if(this.appIsExplicit!=this.opera.canzoni[this.currentIndex].isExplicit){Animations.fade(element,(()=>{element.innerHTML=`${this.opera.canzoni[this.currentIndex].isExplicit?Constants.EXPLICIT("span",11,0,2):""}`}));return!this.appIsExplicit}return this.appIsExplicit};waitingLoad=imageURL=>{this.timingBar.setDisabled(true);this.timingBar.setDuration(100);this.timingBar.setValue(0);this.progressBar.disabled=true;this.navSongSvg.style.display="none";this.albumIcon.style.cursor="pointer";this.albumIcon.style.backgroundImage=`url('${imageURL}')`;this.songInfo.innerHTML=Constants.LOADING_SECOND("animated-circle",30,0,0,10);this.animateExplicitSong(this.explicitSong);this.songName.innerHTML="";const circle=document.querySelector(".animated-circle circle");circle.style.opacity=1};waitingLoadSmall=imageURL=>{this.timingBarSmall.setDisabled(true);this.timingBarSmall.setDuration(100);this.timingBarSmall.setValue(0);this.progressBarSmall.disabled=true;this.navSongSvgSmall.style.display="none";this.albumIconSmall.style.cursor="pointer";this.albumIconSmall.style.backgroundImage=`url('${imageURL}')`;this.songInfoSmall.innerHTML=Constants.LOADING_SECOND("animated-circle-second",30,0,0,10);this.appIsExplicit=this.animateExplicitSong(this.explicitSongSmall);this.songNameSmall.innerHTML="";const circleSmall=document.querySelector(".animated-circle-second circle");circleSmall.style.opacity=1};firstLoad=text=>{this.timingBar.setDisabled(true);this.timingBar.setDuration(100);this.timingBar.setValue(0);this.progressBar.disabled=true;this.navSongSvg.style.display="block";this.albumIcon.style.backgroundColor="var(--bg-btn-music)";this.albumIcon.style.cursor="default";this.songInfo.innerHTML=text;this.animateExplicitSong(this.explicitSong);this.songName.innerHTML=""};firstLoadSmall=text=>{this.timingBarSmall.setDisabled(true);this.timingBarSmall.setDuration(100);this.timingBarSmall.setValue(0);this.progressBarSmall.disabled=true;this.navSongSvgSmall.style.display="block";this.albumIconSmall.style.backgroundColor="var(--bg-btn-music)";this.albumIconSmall.style.cursor="default";this.songInfoSmall.innerHTML=text;this.appIsExplicit=this.animateExplicitSong(this.explicitSongSmall);this.songNameSmall.innerHTML=""};secondLoad=duration=>{this.timingBar.setDisabled(false);this.progressBar.disabled=false;this.timingBar.setDuration(duration);this.timingBar.setValue(0);this.navSongSvg.style.display="none";this.albumIcon.style.backgroundColor="transparent";this.albumIcon.style.backgroundImage=`url(${this.opera.prodotto.image})`;this.animateExplicitSong(this.explicitSong);this.songName.innerHTML=this.opera.canzoni[this.currentIndex].name;this.songInfo.innerHTML=`${this.opera.prodotto.author} - ${this.opera.canzoni[this.currentIndex].collabs!=""?`${this.opera.canzoni[this.currentIndex].collabs}`:"Single"}`};secondLoadSmall=duration=>{this.albumIcon.style.cursor="pointer";this.albumIconSmall.style.cursor="pointer";this.albumIconSmall.style.backgroundColor="transparent";this.navSongSvgSmall.style.display="none";this.timingBarSmall.setDisabled(false);this.timingBarSmall.setValue(0);this.progressBarSmall.disabled=false;this.timingBarSmall.setDuration(duration);this.albumIconSmall.style.backgroundImage=`url(${this.opera.prodotto.image})`;this.appIsExplicit=this.animateExplicitSong(this.explicitSongSmall);this.songNameSmall.innerHTML=this.opera.canzoni[this.currentIndex].name;this.songInfoSmall.innerHTML=`${this.opera.prodotto.author} - ${this.opera.canzoni[this.currentIndex].collabs!=""?`${this.opera.canzoni[this.currentIndex].collabs}`:"Single"}`};fetchData=()=>{fetch("config/session.php",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:`music_id=${encodeURIComponent(this.opera.canzoni[this.currentIndex].id)}&album_id=${encodeURIComponent(this.opera.prodotto.id)}`}).catch((error=>{console.log(error)}))};innerHTML=()=>`\n            <div class="outer-nav">\n                <div class="navbar" >\n                    <div class="nav-border">\n                        <div class="nav-item left">\n                            <svg xmlns="http://www.w3.org/2000/svg"  id="shuffle-icon" width="16" height="16" fill="currentcolor" class="bi bi-shuffle icon " viewBox="0 0 16 16">\n                            <path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.6 9.6 0 0 0 7.556 8a9.6 9.6 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.6 10.6 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.6 9.6 0 0 0 6.444 8a9.6 9.6 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5"/>\n                            <path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192"/>\n                            </svg>\n                            <svg xmlns="http://www.w3.org/2000/svg" id="skip-backward-icon" width="16" height="16" fill="currentcolor" class="bi bi-skip-backward icon " viewBox="0 0 16 16">\n                            <path d="M.5 3.5A.5.5 0 0 1 1 4v3.248l6.267-3.636c.52-.302 1.233.043 1.233.696v2.94l6.267-3.636c.52-.302 1.233.043 1.233.696v7.384c0 .653-.713.998-1.233.696L8.5 8.752v2.94c0 .653-.713.998-1.233.696L1 8.752V12a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5m7 1.133L1.696 8 7.5 11.367zm7.5 0L9.196 8 15 11.367z"/>\n                            </svg>\n                            <svg xmlns="http://www.w3.org/2000/svg" id="play-fill-icon" width="16" height="16" fill="currentcolor" class="bi bi-play-fill icon " viewBox="0 0 16 16">\n                            <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"/>\n                            </svg>\n                            <svg xmlns="http://www.w3.org/2000/svg" id="skip-forward-icon" width="16" height="16" fill="currentcolor" class="bi bi-skip-forward icon " viewBox="0 0 16 16">\n                            <path d="M15.5 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V8.752l-6.267 3.636c-.52.302-1.233-.043-1.233-.696v-2.94l-6.267 3.636C.713 12.69 0 12.345 0 11.692V4.308c0-.653.713-.998 1.233-.696L7.5 7.248v-2.94c0-.653.713-.998 1.233-.696L15 7.248V4a.5.5 0 0 1 .5-.5M1 4.633v6.734L6.804 8zm7.5 0v6.734L14.304 8z"/>\n                            </svg>\n                            <svg xmlns="http://www.w3.org/2000/svg" id="repeat-icon" width="16" height="16" fill="currentcolor" class="bi bi-repeat icon" viewBox="0 0 16 16">\n                            <path d="M11 5.466V4H5a4 4 0 0 0-3.584 5.777.5.5 0 1 1-.896.446A5 5 0 0 1 5 3h6V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m3.81.086a.5.5 0 0 1 .67.225A5 5 0 0 1 11 13H5v1.466a.25.25 0 0 1-.41.192l-2.36-1.966a.25.25 0 0 1 0-.384l2.36-1.966a.25.25 0 0 1 .41.192V12h6a4 4 0 0 0 3.585-5.777.5.5 0 0 1 .225-.67Z"/>\n                            </svg>\n                        </div>\n                        <div class="outer-navbar-center-elem" id="navbar-center-elem">\n\n                            <div class="nav-item center" >\n                                <div class="center-square" id="nav-album-icon" >\n                                    <div id="navbar-explicit-song" class="nav-explicit-svg"></div>\n                                    <div id="nav-song-svg" class="nav-song-svg"></div>\n                                </div>\n                                <div class="center-div" id="content-center">\n                                    <div class="nav-song-name" id="song-name"></div>\n                                    <div class="nav-song-info"  id="song-info"></div>\n                                    <div class="song-panel">\n                                        <input type="range" id="timing-bar" value="0" min="0" max="100" readonly="" class="timing-bar">\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="nav-item right">\n                            <svg xmlns="http://www.w3.org/2000/svg" id="volume-off-fill-icon"  width="16" height="16" fill="currentcolor" class="bi bi-volume-off-fill icon " viewBox="0 0 16 16">\n                            <path d="M10.717 3.55A.5.5 0 0 1 11 4v8a.5.5 0 0 1-.812.39L7.825 10.5H5.5A.5.5 0 0 1 5 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06"/>\n                            </svg>\n                            <input type="range" id="progress-bar" class="progress-bar" value="0" min="0" max="100" readonly="" />\n                            <svg xmlns="http://www.w3.org/2000/svg" id="volume-up-fill-icon"  width="16" height="16" fill="currentcolor" class="bi bi-volume-up-fill icon" viewBox="0 0 16 16">\n                            <path d="M11.536 14.01A8.47 8.47 0 0 0 14.026 8a8.47 8.47 0 0 0-2.49-6.01l-.708.707A7.48 7.48 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303z"/>\n                            <path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.48 5.48 0 0 1 11.025 8a5.48 5.48 0 0 1-1.61 3.89z"/>\n                            <path d="M8.707 11.182A4.5 4.5 0 0 0 10.025 8a4.5 4.5 0 0 0-1.318-3.182L8 5.525A3.5 3.5 0 0 1 9.025 8 3.5 3.5 0 0 1 8 10.475zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06"/>\n                            </svg>\n                        </div>\n                    </div>\n                </div>\n                <div class="navbar-small" >\n                                            <div class="outer-navbar-center-elem-small" id="navbar-center-elem-small">\n\n                    <div class="navbar-row-small">\n                            <div class="inner-navbar-row-small " >\n                                <div class="image-album-small" id="nav-album-icon-small" >\n                                    <span id="navbar-explicit-song-small" class="nav-explicit-svg"></span>\n                                    <div id="nav-song-svg-small" class="nav-song-svg"></div>\n                                </div>\n                                <div class="center-div" id="content-center-small">\n                                    <div class="nav-song-name" id="song-name-small"></div>\n                                    <div class="nav-song-info"  id="song-info-small"> </div>\n                                    <div class="song-panel">\n                                        <input type="range" id="timing-bar-small" value="0" min="0" max="100" readonly="" class="timing-bar">\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="navbar-row-small-second">\n                        <div class="navbar-col-small">\n                            <svg xmlns="http://www.w3.org/2000/svg"  id="shuffle-icon-small" width="16" height="16" fill="currentcolor" class="bi bi-shuffle icon " viewBox="0 0 16 16">\n                            <path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.6 9.6 0 0 0 7.556 8a9.6 9.6 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.6 10.6 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.6 9.6 0 0 0 6.444 8a9.6 9.6 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5"/>\n                            <path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192"/>\n                            </svg>\n                            <svg xmlns="http://www.w3.org/2000/svg" id="skip-backward-icon-small" width="16" height="16" fill="currentcolor" class="bi bi-skip-backward icon " viewBox="0 0 16 16">\n                            <path d="M.5 3.5A.5.5 0 0 1 1 4v3.248l6.267-3.636c.52-.302 1.233.043 1.233.696v2.94l6.267-3.636c.52-.302 1.233.043 1.233.696v7.384c0 .653-.713.998-1.233.696L8.5 8.752v2.94c0 .653-.713.998-1.233.696L1 8.752V12a.5.5 0 0 1-1 0V4a.5.5 0 0 1 .5-.5m7 1.133L1.696 8 7.5 11.367zm7.5 0L9.196 8 15 11.367z"/>\n                            </svg>\n                            <svg xmlns="http://www.w3.org/2000/svg" id="play-fill-icon-small" width="16" height="16" fill="currentcolor" class="bi bi-play-fill icon " viewBox="0 0 16 16">\n                            <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"/>\n                            </svg>\n                            <svg xmlns="http://www.w3.org/2000/svg" id="skip-forward-icon-small" width="16" height="16" fill="currentcolor" class="bi bi-skip-forward icon " viewBox="0 0 16 16">\n                            <path d="M15.5 3.5a.5.5 0 0 1 .5.5v8a.5.5 0 0 1-1 0V8.752l-6.267 3.636c-.52.302-1.233-.043-1.233-.696v-2.94l-6.267 3.636C.713 12.69 0 12.345 0 11.692V4.308c0-.653.713-.998 1.233-.696L7.5 7.248v-2.94c0-.653.713-.998 1.233-.696L15 7.248V4a.5.5 0 0 1 .5-.5M1 4.633v6.734L6.804 8zm7.5 0v6.734L14.304 8z"/>\n                            </svg>\n                            <svg xmlns="http://www.w3.org/2000/svg" id="repeat-icon-small" width="16" height="16" fill="currentcolor" class="bi bi-repeat icon" viewBox="0 0 16 16">\n                            <path d="M11 5.466V4H5a4 4 0 0 0-3.584 5.777.5.5 0 1 1-.896.446A5 5 0 0 1 5 3h6V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m3.81.086a.5.5 0 0 1 .67.225A5 5 0 0 1 11 13H5v1.466a.25.25 0 0 1-.41.192l-2.36-1.966a.25.25 0 0 1 0-.384l2.36-1.966a.25.25 0 0 1 .41.192V12h6a4 4 0 0 0 3.585-5.777.5.5 0 0 1 .225-.67Z"/>\n                            </svg>\n                        </div>\n                        <div class="navbar-col-small">\n                            <svg xmlns="http://www.w3.org/2000/svg" id="volume-off-fill-icon-small"  width="16" height="16" fill="currentcolor" class="bi bi-volume-off-fill icon " viewBox="0 0 16 16">\n                            <path d="M10.717 3.55A.5.5 0 0 1 11 4v8a.5.5 0 0 1-.812.39L7.825 10.5H5.5A.5.5 0 0 1 5 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06"/>\n                            </svg>\n                            <input type="range" id="progress-bar-small" class="progress-bar" value="0" min="0" max="100" readonly="" />\n                            <svg xmlns="http://www.w3.org/2000/svg" id="volume-up-fill-icon-small"  width="16" height="16" fill="currentcolor" class="bi bi-volume-up-fill icon" viewBox="0 0 16 16">\n                            <path d="M11.536 14.01A8.47 8.47 0 0 0 14.026 8a8.47 8.47 0 0 0-2.49-6.01l-.708.707A7.48 7.48 0 0 1 13.025 8c0 2.071-.84 3.946-2.197 5.303z"/>\n                            <path d="M10.121 12.596A6.48 6.48 0 0 0 12.025 8a6.48 6.48 0 0 0-1.904-4.596l-.707.707A5.48 5.48 0 0 1 11.025 8a5.48 5.48 0 0 1-1.61 3.89z"/>\n                            <path d="M8.707 11.182A4.5 4.5 0 0 0 10.025 8a4.5 4.5 0 0 0-1.318-3.182L8 5.525A3.5 3.5 0 0 1 9.025 8 3.5 3.5 0 0 1 8 10.475zM6.717 3.55A.5.5 0 0 1 7 4v8a.5.5 0 0 1-.812.39L3.825 10.5H1.5A.5.5 0 0 1 1 10V6a.5.5 0 0 1 .5-.5h2.325l2.363-1.89a.5.5 0 0 1 .529-.06"/>\n                            </svg>\n                        </div>\n                    </div>\n                </div>\n            </div>\n            <div class="nav-footer">\n                <div class="inner-nav-footer" >\n                    <p class="p-nav-footer" id="dynamic-bar">Accedi per caricare brani</p>\n                </div>\n            </div>\n        `}class Artist extends WorkerManager{constructor(id,callbacks){super();this.artist=[];this.albums=[];this.singoli=[];this.id=id;this.callbacks=callbacks;this.albumSwiper=null;this.singoliSwiper=null;this.MAX_LENGTH_INFO_ARTIST=170;this.isLoaded=false}init=async(elementId,isLoaded)=>{this.resetWorkers();this.isLoaded=isLoaded;this.elementId=elementId;await this.fetchWorker("getAllArtistData",{elementId:this.elementId},this.updateArtistData)};updateArtistData=data=>{this.artist=this.setArtist(data.artista);this.albums=this.setData(data.album);this.singoli=this.setData(data.single);this.initializer()};updateAlbums=data=>{this.albums=this.setDataSecond(data)};updateSingles=data=>{this.singoli=this.setDataSecond(data)};mapIds=objects=>objects.map((obj=>obj.id));playRandomMusic=()=>{const checkAlbumsLenght=this.albums.length!=0;const checkSingoliLenght=this.singoli.length!=0;if(checkAlbumsLenght&&checkSingoliLenght){if(Math.round(Math.random())==0){const index=Math.floor(Math.random()*this.albums.length);this.callbacks.onlyShuffle(this.albums[index].id)}else{const index=Math.floor(Math.random()*this.singoli.length);this.callbacks.onlyPlay(this.singoli[index].id)}}else if(checkAlbumsLenght){const index=Math.floor(Math.random()*this.albums.length);this.callbacks.onlyShuffle(this.albums[index].id)}else if(checkSingoliLenght){const index=Math.floor(Math.random()*this.singoli.length);this.callbacks.onlyPlay(this.singoli[index].id)}};initializer=()=>{document.getElementById(this.id).innerHTML=this.innerHTML();this.albumSwiper=new MySwiper("container-album-artist-slider","album-artist-slider",this.albums,false,this.callbacksManager().swiperAlbum,"album",true);this.singoliSwiper=new MySwiper("container-singoli-artist-slider","singoli-artist-slider",this.singoli,false,this.callbacksManager().swiperSingolo,"single",true);const playArtistLeft=document.getElementById("svg-play-clickable-left");playArtistLeft.addEventListener("click",(()=>{Animations.fade(playArtistLeft,(()=>{this.playRandomMusic()}))}));const playArtistRight=document.getElementById("svg-play-clickable-right");playArtistRight.addEventListener("click",(()=>{Animations.fade(playArtistRight,(()=>{this.playRandomMusic()}))}));const tooltip=document.createElement("div");tooltip.className="tooltip-right";tooltip.innerText="Link copiato";document.getElementsByClassName("share-artist-btn-container")[0].appendChild(tooltip);const shareArtistBtn=document.getElementById("share-artist-btn");shareArtistBtn.addEventListener("click",(()=>{new ClipboardJS(`#share-artist-btn`);Animations.fade(shareArtistBtn,(()=>{}));Animations.fadeOut(3e3,tooltip,(()=>{}))}));if(this.artist.description.length>this.MAX_LENGTH_INFO_ARTIST){const toggleRead=document.getElementById("toggle-read-artist-description");toggleRead.addEventListener("click",(()=>{Animations.fade(toggleRead,(()=>this.toggleTextDescription(toggleRead)))}))}};toggleTextDescription=toggleRead=>{const toggleText=document.getElementById("toggle-text-artist-description");if(this.artist.description.length>this.MAX_LENGTH_INFO_ARTIST){if(toggleText.textContent.length>=this.artist.description.length){toggleText.textContent=`${this.artist.description.length>this.MAX_LENGTH_INFO_ARTIST?`${this.artist.description.substring(0,this.MAX_LENGTH_INFO_ARTIST).trim().substring(0,this.artist.description.substring(0,this.MAX_LENGTH_INFO_ARTIST).lastIndexOf(" "))}...`:this.artist.description}`;toggleRead.textContent="ALTRO"}else{toggleText.textContent=this.artist.description;toggleRead.textContent="MENO"}}};asyncManager=()=>{const asyncAlbums=()=>{const asyncOperation=async()=>{const result=this.mapIds(this.albums);const resultStr=result.join(",");await this.fetchWorker("getAlbums",{elementId:this.elementId,resultStr:resultStr},this.updateAlbums);return this.albums};return{asyncOperation:asyncOperation}};const asyncSingles=()=>{const asyncOperation=async()=>{const result=this.mapIds(this.albums);const resultStr=result.join(",");await this.fetchWorker("getSingles",{elementId:this.elementId,resultStr:resultStr},this.updateSingles);return this.singoli};return{asyncOperation:asyncOperation}};return{asyncAlbums:asyncAlbums(),asyncSingles:asyncSingles()}};callbacksManager=()=>{const callbacksSwiperAlbum=()=>{const onClick=(elementId,elementType)=>{this.callbacks.goToPage(elementId,elementType)};const touchEnd=async()=>{await this.albumSwiper.waitingNewElementsInnerHTML(this.asyncManager().asyncAlbums.asyncOperation,[])};const setMusicList=(elementId,elementType)=>{this.callbacks.setMusicList(elementId,elementType)};return{onClick:onClick,touchEnd:touchEnd,setMusicList:setMusicList}};const callbacksSwiperSingolo=()=>{const onClick=(elementId,elementType)=>{this.callbacks.goToPage(elementId,elementType)};const touchEnd=async()=>{await this.singoliSwiper.waitingNewElementsInnerHTML(this.asyncManager().asyncSingles.asyncOperation,[])};const setMusicList=(elementId,elementType)=>{this.callbacks.setMusicList(elementId,elementType)};return{onClick:onClick,touchEnd:touchEnd,setMusicList:setMusicList}};return{swiperAlbum:callbacksSwiperAlbum(),swiperSingolo:callbacksSwiperSingolo()}};setArtist=obj=>({name:obj.ArtistName,description:obj.ArtistDescription,luogoNascita:obj.BirthPlace,dataNascita:obj.BirthDate,genereMusicale:obj.ArtistGenre,image:`url(${obj.ArtistImage})`,id:obj.IdArtista});setData=obj=>{const data=[];obj.forEach((item=>{data.push({name:item.PublicationTitle,genereMusicale:item.PublicationGenre,image:`url(${item.PublicationImage})`,isExplicit:item.IsExplicit==0?false:true,id:item.IdPubblicazione})}));return data};setDataSecond=obj=>{const data=[];obj.forEach((item=>{data.push({name:item.Titolo,genereMusicale:item.GenereMusicale,image:`url(${item.Immagine})`,isExplicit:item.IsExplicit==0?false:true,id:item.IdPubblicazione})}));return data};innerHTML=()=>`\n   \n\n\n\n\n            \n            <div class="main-container">\n                            <div class="artist-header">\n\n                <div class="artist-inner-header">\n                    <div class="artist-image" id="artist-image-preview" style="background-image:${this.artist.image};">\n                        <div class="overlay-artist-image"></div>\n                    </div>\n\n                </div>\n\n                <div class="share-svg-container">\n                <div class="outer-share-svg-container">\n                    <div class="inner-share-svg-container-artist">\n                    <div class="share-artist-btn-container"  id="share-artist-btn" data-clipboard-text="${Constants.URL("artist",`&idArtist=${this.elementId}`)}">\n                    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentcolor" class="bi bi-share-fill share-icon-artist" viewBox="0 0 16 16">\n  <path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5"/>\n</svg>\n  </div>\n                    </div>\n                    </div>\n                </div>\n                <div class="artist-name-container">\n                 \n                <div class="outer-artist-name-container">\n                    <div class="inner-artist-name-container">\n                        <div class="artist-icon-title">\n                            <svg xmlns="http://www.w3.org/2000/svg" id="svg-play-clickable-left" width="32" height="32" fill="var(--primary-color)" class=" bi bi-play-circle-fill play-icon-artist" viewBox="0 0 16 16">\n                                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M6.79 5.093A.5.5 0 0 0 6 5.5v5a.5.5 0 0 0 .79.407l3.5-2.5a.5.5 0 0 0 0-.814z"/>\n                            </svg>\n                        </div>\n                            <p class="artist-name-title" id="artist-name-preview">${this.artist.name}</p>   \n\n\n                    </div>\n                    <div>\n\n                    <div class="artist-icon-title-right">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="32"  height="32" id="svg-play-clickable-right"  fill="var(--primary-color)" class=" bi bi-play-circle-fill play-icon-artist" viewBox="0 0 16 16">\n                            <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0M6.79 5.093A.5.5 0 0 0 6 5.5v5a.5.5 0 0 0 .79.407l3.5-2.5a.5.5 0 0 0 0-.814z"/>\n                        </svg>\n                    </div>\n                    \n                    </div>\n                </div>\n                <div>\n\n\n\n                </div>\n\n\n                </div>\n            </div>\n\n\n            <div class="main-content">\n        \n\n    \n            ${this.albums.length!=0?`   \n                            <div class="songs">Album</div>\n                            <div class="slides-container" id="container-album-artist-slider"></div>\n                        `:``}\n              \n        \n           ${this.singoli.length!=0?`\n                        <div class="songs">Singoli</div>\n                        <div class="slides-container" id="container-singoli-artist-slider"></div>\n                    `:``}\n\n            </div>\n            <div class=" ${this.singoli.length==0&&this.albums.length==0?`outer-container-info-artist-second`:`outer-container-info-artist`}">\n               <div class="app-container-info" id="block-info-artist">\n                    <div class="inner-container-info-artist">\n   <div class="primary-container-info-artist">\n      <p class="title-info-artist" id="artist-title-info-preview">Informazioni su ${this.artist.name}</p>\n      <div class="container-info-artist">\n         ${this.artist.description.length!=0?`<div class="left-column-info-artist">${this.artist.description}</div>`:''}\n         ${this.artist.description.length!=0?`<div class="left-column-info-artist-small" >\n            <span id="toggle-text-artist-description">\n            ${this.artist.description.length>this.MAX_LENGTH_INFO_ARTIST?`${this.artist.description.substring(0,this.MAX_LENGTH_INFO_ARTIST).trim().substring(0,this.artist.description.substring(0,this.MAX_LENGTH_INFO_ARTIST).lastIndexOf(" "))}...`:this.artist.description}\n            </span>  \n            ${this.artist.description.length>this.MAX_LENGTH_INFO_ARTIST?`\n            <p class="leggi-ancora" id="toggle-read-artist-description">ALTRO</p>\n            `:""}\n         </div>`:''}\n         <div class="right-column-info-artist">\n            <div class="info-row-info-artist">\n               <div class="title-generic-info-artist">LUOGO DI NASCITA:</div>\n               <div>${this.artist.luogoNascita}</div>\n            </div>\n            <div class="info-row-info-artist">\n               <div class="title-generic-info-artist">DATA DI NASCITA:</div>\n        <div>${(()=>{const mesi=["gennaio","febbraio","marzo","aprile","maggio","giugno","luglio","agosto","settembre","ottobre","novembre","dicembre"];const date=new Date(this.artist.dataNascita);const giorno=date.getDate();const mese=date.getMonth();const anno=date.getFullYear();return`${giorno} ${mesi[mese]} ${anno}`})()}</div>\n\n\n            </div>\n            <div class="info-row-info-artist">\n               <div class="title-generic-info-artist">GENERE:</div>\n               <div>${this.artist.genereMusicale}</div>\n            </div>\n         </div>\n      </div>\n   </div>\n</div>\n </div>\n</div>\n        </div>\n\n\n\n\n        `}class Home extends WorkerManager{constructor(id,callbacks){super();this.albums=[];this.artists=[];this.lastAlbums=[];this.lastArtists=[];this.id=id;this.callbacks=callbacks;this.searchBar;this.albumSwiper;this.artistSwiper;this.lastText=""}init=async()=>{this.resetWorkers();if(this.lastAlbums.length==0&&this.lastArtists.length==0){await this.fetchWorker("getAllHomeData",{},this.updateHomeData)}else{this.initializer()}};updateAlbums=data=>{if(data.length!=0){this.lastAlbums=this.albums;this.albums=this.setterAlbums(data)}};updateArtists=data=>{if(data.length!=0){this.lastArtists=this.artists;this.artists=this.setterArtists(data)}};updateHomeData=data=>{this.albums=this.setterAlbums(data.musics);this.artists=this.setterArtists(data.artists);this.lastAlbums=this.albums;this.lastArtists=this.artists;this.initializer()};initializer=()=>{document.getElementById(this.id).innerHTML=this.innerHTML();this.albumSwiper=new MySwiper("container-album-slider","album-slider",this.albums,false,this.callbacksManager().swiperAlbum,"album",false);this.artistSwiper=new MySwiper("container-artist-slider","artist-slider",this.artists,true,this.callbacksManager().swiperArtist,"artist",false);this.searchBar=new SearchBar(".input-search",this.callbacksManager().searchbar);this.searchBar.setInput(this.lastText);this.searchBar.init();this.setScripts()};setScripts=()=>{const imgPersonClickable=document.getElementById("img-person-clickable");imgPersonClickable.addEventListener("click",(()=>{Animations.fade(imgPersonClickable,(()=>{}))}))};asyncManager=()=>{const recursiveCall=callback=>{const checkInterval=100;const stableTime=1e3;let lastSearchText=this.searchBar.searchText;let stableFor=0;const checkSearchText=async()=>{if(this.searchBar.searchText===lastSearchText){stableFor+=checkInterval;if(stableFor>=stableTime){const inputSearch=document.getElementById("input-search");if(inputSearch&&inputSearch.disabled==false){inputSearch.disabled=true}this.lastText=this.searchBar.searchText;return await callback.asyncOperation(this.searchBar.searchText)}}else{lastSearchText=this.searchBar.searchText;stableFor=0}await new Promise((resolve=>setTimeout(resolve,checkInterval)));return checkSearchText()};return checkSearchText()};const containsAllChars=(name,text)=>{const normalizedName=name.toLowerCase().replace(/\s+/g,"");const normalizedText=text.toLowerCase().replace(/\s+/g,"");const nameCharCount={};for(let char of normalizedName){nameCharCount[char]=(nameCharCount[char]||0)+1}for(let char of normalizedText){if(!nameCharCount[char]||nameCharCount[char]<=0){return false}nameCharCount[char]--}return true};const mapIds=objects=>objects.map((obj=>obj.id));const searchObjectIdsByChars=(objects,text)=>objects.filter((obj=>containsAllChars(obj.name,text))).map((obj=>obj.id));function formatForRegexp(str){const escapeRegExp=s=>s.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");const escapedStr=escapeRegExp(str);const regexpStr=escapedStr.split("").map((char=>`.*${char}`)).join("");return regexpStr}const asyncAlbums=()=>{const asyncOperation=async()=>{const result=mapIds(this.albums);const resultStr=result.join(",");await this.fetchWorker("getMusics",{resultStr:resultStr},this.updateAlbums);return this.albums};return{asyncOperation:asyncOperation}};const asyncArtists=()=>{const asyncOperation=async()=>{const result=mapIds(this.artists);const resultStr=result.join(",");await this.fetchWorker("getArtists",{resultStr:resultStr},this.updateArtists);return this.artists};return{asyncOperation:asyncOperation}};const asyncSearchArtists=()=>{const asyncOperation=async _text=>{const text=_text.replace(/\s/g,"");const resultREGEXP=text==""?".*":formatForRegexp(text);const result=searchObjectIdsByChars(this.artists,text);const resultStr=result.join(",");const response=await this.fetchWorker("getSearchedArtists",{resultREGEXP:resultREGEXP,resultStr:resultStr},this.updateArtists);return this.setterArtists(response)};return{asyncOperation:asyncOperation}};const asyncSearchAlbums=()=>{const asyncOperation=async _text=>{const text=_text.replace(/\s/g,"");const resultREGEXP=text==""?".*":formatForRegexp(text);const result=searchObjectIdsByChars(this.artists,text);const resultStr=result.join(",");const response=await this.fetchWorker("getSearchedMusics",{resultREGEXP:resultREGEXP,resultStr:resultStr},this.updateAlbums);return this.setterAlbums(response)};return{asyncOperation:asyncOperation}};const asyncSearchBarAlbums=()=>{const asyncOperation=async()=>recursiveCall(this.asyncManager().asyncSearchAlbums);return{asyncOperation:asyncOperation}};const asyncSearchBarArtists=()=>{const asyncOperation=async()=>recursiveCall(this.asyncManager().asyncSearchArtists);return{asyncOperation:asyncOperation}};return{asyncAlbums:asyncAlbums(),asyncArtists:asyncArtists(),asyncSearchAlbums:asyncSearchAlbums(),asyncSearchArtists:asyncSearchArtists(),asyncSearchBarAlbums:asyncSearchBarAlbums(),asyncSearchBarArtists:asyncSearchBarArtists()}};callbacksManager=()=>{const callbacksSearchBar=()=>{const onChange=async()=>{const appLastArtists=this.lastArtists;const appLastAlbums=this.lastAlbums;await Promise.all([this.albumSwiper.waitingNewElementsInnerHTML(this.asyncManager().asyncAlbums.asyncOperation,this.asyncManager().asyncSearchBarAlbums.asyncOperation,appLastAlbums),this.artistSwiper.waitingNewElementsInnerHTML(this.asyncManager().asyncArtists.asyncOperation,this.asyncManager().asyncSearchBarArtists.asyncOperation,appLastArtists)]);setTimeout((function(){const inputSearch=document.getElementById("input-search");if(inputSearch&&inputSearch.disabled==true){inputSearch.disabled=false}}),1e3)};return{onChange:onChange}};const callbacksSwiperAlbum=()=>{const onClick=(elementId,elementType)=>{this.callbacks.goToPage(elementId,elementType)};const touchEnd=async()=>{const appLastAlbums=this.lastAlbums;await this.albumSwiper.waitingNewElementsInnerHTML(this.asyncManager().asyncAlbums.asyncOperation,this.asyncManager().asyncSearchBarAlbums.asyncOperation,appLastAlbums)};const setMusicList=(elementId,elementType)=>{this.callbacks.setMusicList(elementId,elementType)};return{onClick:onClick,touchEnd:touchEnd,setMusicList:setMusicList}};const callbacksSwiperArtist=()=>{const onClick=(elementId,elementType)=>{this.callbacks.goToPage(elementId,elementType)};const touchEnd=async()=>{const appLastArtists=this.lastArtists;await this.artistSwiper.waitingNewElementsInnerHTML(this.asyncManager().asyncArtists.asyncOperation,this.asyncManager().asyncSearchBarArtists.asyncOperation,appLastArtists)};const setMusicList=(elementId,elementType)=>{this.callbacks.setMusicList(elementId,elementType)};return{onClick:onClick,touchEnd:touchEnd,setMusicList:setMusicList}};return{searchbar:callbacksSearchBar(),swiperAlbum:callbacksSwiperAlbum(),swiperArtist:callbacksSwiperArtist()}};setterAlbums=data=>{const albums=[];for(let i=0;i<data.length;i++){albums.push({name:data[i].Titolo,genereMusicale:data[i].GenereMusicale,image:`url(${data[i].Immagine})`,isExplicit:data[i].IsExplicit==0?false:true,id:data[i].IdPubblicazione})}return albums};setterArtists=data=>{const artists=[];for(let i=0;i<data.length;i++){artists.push({name:data[i].Nome,genereMusicale:data[i].GenereMusicale,image:`url(${data[i].Immagine})`,isExplicit:false,id:data[i].IdArtista})}return artists};innerHTML=()=>`\n                    <div class="main-container">\n                        <div class="main-content">\n                            <div class="header-home">\n                                <div class="page">Home</div>\n                                <div class="profile">\n                                    <svg id="img-person-clickable" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(128,128,128,1)" class="bi bi-person-circle icon-person" viewBox="0 0 16 16">\n                                        <path d="M11 6a3 3 0 1 1-6 0 3 3 0 0 1 6 0"/>\n                                        <path fill-rule="evenodd" d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8m8-7a7 7 0 0 0-5.468 11.37C3.242 11.226 4.805 10 8 10s4.757 1.225 5.468 2.37A7 7 0 0 0 8 1"/>\n                                    </svg>\n\n                                </div>\n                            </div>\n                            <div class="search-bar">\n                                <div class="inner-search-bar">\n\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="rgb(128,128,128,1)" class="bi bi-search icon-src" viewBox="0 0 16 16">\n                                        <path d="M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001q.044.06.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1 1 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0"/>\n                                    </svg>\n\n                                    <input id="input-search" class="input-search" placeholder="Ricerca brani o artisti" type="text"/>\n                                </div>\n                            </div>\n                            <div class="songs">Album e Singoli</div>\n                            <div class="slides-container" id="container-album-slider"></div>\n                            <div class="songs">Artisti</div>\n                            <div class="slides-container" id="container-artist-slider"></div>\n                        </div>\n                    </div>\n    \n                \n                `}class Music extends WorkerManager{constructor(id,callbacks){super();this.opera=[];this.id=id;this.callbacks=callbacks;this.totalTimeSpan=null;this.elementId=-1;this.isAllDownloaded=false;this.isToggleClickedSong=false;this.isClickedSong=-1}init=async elementId=>{this.resetWorkers();this.isAllDownloaded=false;this.elementId=elementId;await this.fetchWorker("getMusic",{elementId:this.elementId},this.updateMusicData);this.updateMusic(-1);this.isAllDownloaded=false};updateMusic=forceInx=>{if(this.elementId==this.callbacks.getAlbumId()&&this.elementId!=-1||this.elementId==-1&&this.callbacks.getAlbumId()!=-1){let inx=-1;for(let i=0;i<this.opera.canzoni.length;i++){if(this.opera.canzoni[i].id==this.callbacks.getSingleId()){inx=i;break}}if(forceInx!=-1){inx=forceInx}if(inx!=-1){if(this.isClickedSong!=inx){this.isClickedSong=inx;this.isToggleClickedSong=false}else{this.isToggleClickedSong=!this.isToggleClickedSong}const containerCanzoni=document.getElementById("container-canzoni");const canzoniElements=containerCanzoni.getElementsByClassName("container-canzone");const numberSongElement=canzoniElements[inx].querySelector(".number-song");const containerCanzoniSmall=document.getElementById("container-canzoni-small");const canzoniSmall=containerCanzoniSmall.querySelectorAll(".container-canzone-small");const numberSongElementSmall=canzoniSmall[inx].querySelector(".number-song-small");Array.from(canzoniElements).forEach(((canzone,j)=>{const _numberSongElement=canzone.querySelector(".number-song");_numberSongElement.innerHTML=j+1;this.opera.canzoni[j].isPlaying=false}));Array.from(canzoniSmall).forEach(((canzone,j)=>{const _numberSongElementSmall=canzone.querySelector(".number-song-small");_numberSongElementSmall.innerHTML=j+1}));if(this.callbacks.getIsPlaying()==true){Animations.fade(numberSongElement,(()=>{numberSongElement.innerHTML=Constants.MUSIC}));Animations.fade(numberSongElementSmall,(()=>{numberSongElementSmall.innerHTML=Constants.MUSIC}));this.opera.canzoni[inx].isPlaying=true}else{Animations.fade(numberSongElement,(()=>{numberSongElement.innerHTML=Constants.POINT}));Animations.fade(numberSongElementSmall,(()=>{numberSongElementSmall.innerHTML=Constants.POINT}));this.opera.canzoni[inx].isPlaying=false}}}};updateMusicData=data=>{this.opera=this.setOpera(data);this.initializer()};callbackFetchAudioWorker=data=>{const totalMinutes=Math.floor(data/60);Animations.fade(this.totalTimeSpan,(()=>{this.totalTimeSpan.innerHTML=`${totalMinutes} minutes`}));setTimeout((()=>{this.isAllDownloaded=true}),1e3)};onClickSong=async(numberSongElement,canzoniElements,i,state)=>{this.startState=!this.startState;this.clickCounter=-1;const appIsPlaying=this.opera.canzoni[i].isPlaying;Array.from(canzoniElements).forEach(((canzone,j)=>{const numberSongElement=canzone.querySelector(".number-song");numberSongElement.innerHTML=j+1;this.opera.canzoni[j].isPlaying=false}));if(appIsPlaying==true){Animations.fadeCustomTimer(150,numberSongElement,(()=>{numberSongElement.innerHTML=Constants.PLAY}));this.opera.canzoni[i].isPlaying=false}else{Animations.fadeCustomTimer(150,numberSongElement,(()=>{numberSongElement.innerHTML=state==true?Constants.MUSIC:Constants.PAUSE}));this.opera.canzoni[i].isPlaying=true}};onClickSongSmall=async(canzoniSmall,canzone,i)=>{await this.callbacks.togglePlaySong(this.opera.prodotto.id,this.opera.canzoni[i].id);const numberSongElement=canzone.querySelector(".number-song-small");const appIsPlaying=this.opera.canzoni.map((canzone=>canzone.isPlaying));if(this.isClickedSong!=i){this.isToggleClickedSong=false;Array.from(canzoniSmall).forEach(((canzoneSmall,j)=>{if(j!=i){canzoneSmall.querySelector(".number-song-small").innerHTML=j+1}}));this.isClickedSong=i;if(appIsPlaying[i]==true){Animations.fade(numberSongElement,(()=>{numberSongElement.innerHTML=`${i+1}`}));appIsPlaying[i]=false}else{for(let j=0;j<appIsPlaying.length;j++){if(appIsPlaying[j]==true){appIsPlaying[j]=false;const previousElement=canzoniSmall[j];const previousNumberSongElement=previousElement.querySelector(".number-song-small");Animations.fade(previousNumberSongElement,(()=>{previousNumberSongElement.innerHTML=`${j+1}`}))}}Animations.fade(numberSongElement,(()=>{numberSongElement.innerHTML=Constants.MUSIC}))}}else{if(this.isToggleClickedSong==true){Animations.fade(numberSongElement,(()=>{numberSongElement.innerHTML=Constants.MUSIC}));this.isToggleClickedSong=false}else{this.isToggleClickedSong=true;Animations.fade(numberSongElement,(()=>{numberSongElement.innerHTML=Constants.POINT}))}}if(i%2===0){canzone.classList.remove("bg-active")}canzone.classList.add("song-hover");canzone.style.transition="opacity 0.5s, transform 0.3s";canzone.style.transform="scale(1.05)";canzone.style.opacity="0.5";setTimeout((()=>{canzone.style.transition="opacity 0.3s, transform 0.3s";canzone.style.transform="scale(1)";canzone.style.opacity="1";setTimeout((()=>{if(i%2===0){canzone.classList.add("bg-active")}canzone.classList.remove("song-hover")}),300)}),300)};setListeners=async()=>{const onMouseOverSong=async(canzone,i,numberSongElement)=>{if(this.opera.canzoni[i].isHover)return;this.opera.canzoni[i].isHover=true;if(i%2===0){canzone.classList.remove("bg-active")}canzone.classList.add("song-hover");if(this.opera.canzoni[i].isPlaying==true){Animations.fadeCustomTimer(150,numberSongElement,(()=>{numberSongElement.innerHTML=Constants.PAUSE}))}else{Animations.fadeCustomTimer(150,numberSongElement,(()=>{numberSongElement.innerHTML=Constants.PLAY}))}};const onMouseLeaveSong=(canzone,i,numberSongElement)=>{this.opera.canzoni[i].isHover=false;if(i%2===0){canzone.classList.add("bg-active")}canzone.classList.remove("song-hover");if(this.isClickedSong==i&&this.opera.canzoni[i].isPlaying==false){Animations.fadeCustomTimer(150,numberSongElement,(()=>{numberSongElement.innerHTML=Constants.POINT}))}else{if(this.opera.canzoni[i].isPlaying==true){Animations.fadeCustomTimer(150,numberSongElement,(()=>{numberSongElement.innerHTML=Constants.MUSIC}))}else{Animations.fadeCustomTimer(150,numberSongElement,(()=>{numberSongElement.innerHTML=`${i+1}`}))}}};const containerCanzoni=document.getElementById("container-canzoni");const canzoniElements=containerCanzoni.getElementsByClassName("container-canzone");const containerCanzoniSmall=document.getElementById("container-canzoni-small");const canzoniSmall=containerCanzoniSmall.querySelectorAll(".container-canzone-small");Array.from(canzoniElements).forEach(((canzone,i)=>{const numberSongElement=canzone.querySelector(".number-song");canzone.addEventListener("mouseover",(()=>onMouseOverSong(canzone,i,numberSongElement)));canzone.addEventListener("mouseleave",(()=>onMouseLeaveSong(canzone,i,numberSongElement)));numberSongElement.addEventListener("click",(async()=>{if(this.isAllDownloaded==true){if(this.callbacks.checkAvailableSong()==true){const canzoneSmall=canzoniSmall[i];await this.onClickSongSmall(canzoniSmall,canzoneSmall,i);this.onClickSong(numberSongElement,canzoniElements,i,false)}}}))}))};initializeSmallContainerListener(){const containerCanzoniSmall=document.getElementById("container-canzoni-small");const canzoniSmall=containerCanzoniSmall.querySelectorAll(".container-canzone-small");const containerCanzoni=document.getElementById("container-canzoni");const canzoniElements=containerCanzoni.getElementsByClassName("container-canzone");canzoniSmall.forEach(((canzoneSmall,i)=>{canzoneSmall.addEventListener("click",(async()=>{if(this.callbacks.checkAvailableSong()==true){if(this.isAllDownloaded==true){const canzone=canzoniElements[i];const numberSongElement=canzone.querySelector(".number-song");await this.onClickSongSmall(canzoniSmall,canzoneSmall,i);this.onClickSong(numberSongElement,canzoniElements,i,true)}}}))}))}initializer=()=>{document.getElementById(this.id).innerHTML=this.innerHTML();this.totalTimeSpan=document.getElementById("total-time-span");const initializeContainer=(containerId,rightInfoClass,animatedCircleClass)=>{const container=document.getElementById(containerId);const rightInfoSongs=container.querySelectorAll(`.${rightInfoClass}`);rightInfoSongs.forEach(((element,index)=>{const circle=document.querySelector(`.${animatedCircleClass}-${index} circle`);if(circle)circle.style.opacity=1;element.classList.add("active-song-charged")}));Animations.fade(this.totalTimeSpan,(()=>{this.totalTimeSpan.innerHTML=Constants.LOADING_THIRD("animated-circle-total-time",15,0,0,0,10,0,10);const circle=document.querySelector(".animated-circle-total-time circle");if(circle)circle.style.opacity=1}));return rightInfoSongs};const rightInfoSongsLarge=initializeContainer("container-canzoni","right-info-song","animated-circle-element");const rightInfoSongsSmall=initializeContainer("container-canzoni-small","right-info-song-small","animated-circle-element-small");const audioUrls=this.opera.canzoni.map((canzone=>canzone.url));const maxParallelFetches=5;let index=0;const fetchNext=()=>{if(index>=audioUrls.length||this.terminated)return;const url=audioUrls[index];const currentIndex=index;index++;this.fetchAudioWorker(url,currentIndex,this.callbackFetchAudioWorker).then((result=>{if(this.terminated)return;const elementLarge=rightInfoSongsLarge[result.index];const elementSmall=rightInfoSongsSmall[result.index];const minutes=Math.floor(result.duration/60);const seconds=Math.floor(result.duration%60);const durationText=`${minutes}:${seconds<10?`0${seconds}`:seconds}`;Animations.fade(elementLarge,(()=>{elementLarge.innerHTML=durationText}));Animations.fade(elementSmall,(()=>{elementSmall.innerHTML=durationText}));fetchNext()})).catch((error=>{console.error("Error during audio processing:",error);fetchNext()}))};for(let i=0;i<maxParallelFetches;i++){fetchNext()}this.setAnimations();this.setListeners();this.initializeSmallContainerListener()};getMinutiSessantesimi=value=>Math.trunc(value/60);getSecondiSessantesimi=value=>Math.trunc(value%60);getMinutes=totalSeconds=>Math.trunc(totalSeconds/60);setAnimations=()=>{const tooltipBottom=document.createElement("div");tooltipBottom.className="tooltip-bottom";tooltipBottom.innerText="Link copiato";document.getElementsByClassName("button-play-opera-share")[0].appendChild(tooltipBottom);const tooltipRight=document.createElement("div");tooltipRight.className="tooltip-right-second";tooltipRight.innerText="Link copiato";document.getElementsByClassName("btn-footer-info-preview-second")[0].appendChild(tooltipRight);const authorOpera=document.getElementById("author-opera");authorOpera.addEventListener("click",(()=>{Animations.fade(authorOpera,(()=>{this.callbacks.goToArtist(this.opera.prodotto.artistId)}))}));const authorOperaSmall=document.getElementById("author-opera-small");authorOperaSmall.addEventListener("click",(()=>{Animations.fade(authorOperaSmall,(()=>{this.callbacks.goToArtist(this.opera.prodotto.artistId)}))}));const btnShareMusic=document.getElementById("btn-share-music");btnShareMusic.addEventListener("click",(()=>{new ClipboardJS(`#btn-share-music`);Animations.fade(btnShareMusic,(()=>{}));Animations.fadeOut(3e3,tooltipRight,(()=>{}))}));const btnShuffleMusic=document.getElementById("btn-shuffle-music");btnShuffleMusic.addEventListener("click",(async()=>{if(this.isAllDownloaded==true){this.callbacks.shuffle(this.elementId,btnShuffleMusic)}}));const btnPlayMusic=document.getElementById("btn-play-music");btnPlayMusic.addEventListener("click",(async()=>{if(this.isAllDownloaded==true){await this.callbacks.togglePlay(this.elementId,btnPlayMusic);this.updateMusic(0)}}));const btnShareMusicSmall=document.getElementById("btn-share-music-small");btnShareMusicSmall.addEventListener("click",(()=>{new ClipboardJS(`#btn-share-music-small`);Animations.fade(btnShareMusicSmall,(()=>{}));Animations.fadeOut(3e3,tooltipBottom,(()=>{}))}));const btnShuffleMusicSmall=document.getElementById("btn-shuffle-music-small");btnShuffleMusicSmall.addEventListener("click",(async()=>{if(this.isAllDownloaded==true){await this.callbacks.shuffle(this.elementId,btnShuffleMusicSmall)}}));const btnPlayMusicSmall=document.getElementById("btn-play-music-small");btnPlayMusicSmall.addEventListener("click",(async()=>{if(this.isAllDownloaded==true){await this.callbacks.togglePlay(this.elementId,btnPlayMusicSmall)}}))};setOpera=obj=>{const musics=[];obj.canzoni.forEach((item=>{musics.push({name:item.Titolo,collabs:item.Featurings,time:0,isExplicit:item.IsExplicit==0?false:true,isHover:false,isPlaying:false,url:item.Audio,id:parseInt(item.IdCanzone)})}));return{prodotto:{name:obj.pubblicazione.Titolo,author:obj.pubblicazione.ArtistName,genereMusicale:obj.pubblicazione.GenereMusicale,description:"Descrizione",image:`url('${obj.pubblicazione.Immagine}')`,dataProduzione:obj.pubblicazione.DataPubblicazione,casaDiscografica:obj.pubblicazione.CasaDiscografica,annoDiProduzione:new Date(obj.pubblicazione.DataPubblicazione).getFullYear().toString(),copyright:"℗ 2024 Musica realizzata con Suno AI",isExplicit:obj.pubblicazione.IsExplicit==1,id:parseInt(obj.pubblicazione.IdPubblicazione),artistId:parseInt(obj.pubblicazione.IdArtista)},canzoni:musics}};innerHTML=()=>`\n\n            <div class="main-container">\n                <div class="main-content">\n                    <div class="container-preview">\n                        <div class="container-image-preview" style="background-image:${this.opera.prodotto.image};">\n                        </div>\n                        <div class="info-preview">\n                            <div class="main-info-preview">\n                                <div class="inner-main-info-preview">\n                                    <p class="text-desc-opera-titolo">${this.opera.prodotto.name}  </p>\n                                    <p class="text-desc-opera-autore" ><span id="author-opera">${this.opera.prodotto.author} <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-box-arrow-up-right icon-change-page" viewBox="0 0 16 16">\n  <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5"/>\n  <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0z"/>\n</svg></span></p>\n                                    <p class="text-desc-opera-genere" >\n                                        ${this.opera.prodotto.isExplicit?`${Constants.EXPLICIT("span",16,0,3)}<span class="dot-spacer"></span> `:""}\n                                        ${this.opera.prodotto.genereMusicale!=""?`${this.opera.prodotto.genereMusicale}<span class="dot-spacer"></span>`:""}\n                                        ${this.opera.prodotto.annoDiProduzione!=""?`${this.opera.prodotto.annoDiProduzione}<span class="dot-spacer"></span>`:""}\n                                        ${this.opera.prodotto.casaDiscografica!=""?`${this.opera.prodotto.casaDiscografica}`:""}\n                                    </p>\n                                </div> \n                            </div>\n                        <div class="footer-info-preview">\n                            <div class="inner-footer-info-preview">\n                                <div class="container-btn-footer-info-preview">\n                                    <div id="btn-play-music" class="btn-footer-info-preview-play">\n                                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="var(--primary-color)" class="bi bi-play-fill " viewBox="0 0 16 16">\n                                            <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"/>\n                                        </svg>\n                                        Play         \n                                    </div>\n                                <div id="btn-shuffle-music" class="btn-footer-info-preview-shuffle">\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" fill="var(--primary-color)" class="bi bi-shuffle svg-music" viewBox="0 0 16 16">\n                                        <path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.6 9.6 0 0 0 7.556 8a9.6 9.6 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.6 10.6 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.6 9.6 0 0 0 6.444 8a9.6 9.6 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5"/>\n                                        <path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192"/>\n                                    </svg>\n                                    Suffle\n                                </div>\n                            </div>\n                            <div class="container-btn-footer-info-preview-second">\n                                <div id="btn-share-music" class="btn-footer-info-preview-second" data-clipboard-text="${Constants.URL("music",`&idMusic=${this.elementId}`)}">\n                                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-share-fill" viewBox="0 0 16 16">\n                                        <path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5"/>\n                                    </svg>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="info-preview-small">\n                    <p class="text-desc-opera-titolo-small">${this.opera.prodotto.name}  </p>\n                    <p class="text-desc-opera-autore-small" ><span id="author-opera-small">${this.opera.prodotto.author}<svg xmlns="http://www.w3.org/2000/svg" width="15" height="15" fill="currentColor" class="bi bi-box-arrow-up-right icon-change-page-small" viewBox="0 0 16 16">\n  <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5"/>\n  <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0z"/>\n</svg></span></p>\n                    <p class="text-desc-opera-genere-small" >\n                        ${this.opera.prodotto.isExplicit?`${Constants.EXPLICIT("span",16,0,3)}<span class="dot-spacer"></span> `:""}\n                        ${this.opera.prodotto.genereMusicale!=""?`${this.opera.prodotto.genereMusicale}<span class="dot-spacer"></span>`:""}\n                        ${this.opera.prodotto.annoDiProduzione!=""?`${this.opera.prodotto.annoDiProduzione}<span class="dot-spacer"></span>`:""}\n                        ${this.opera.prodotto.casaDiscografica!=""?`${this.opera.prodotto.casaDiscografica}`:""}\n                    </p>\n                <div class="container-buttons-play-opera">\n                    <div id="btn-play-music-small" class="button-play-opera">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" fill="var(--primary-color)" class="bi bi-play-fill " viewBox="0 0 16 16">\n                            <path d="m11.596 8.697-6.363 3.692c-.54.313-1.233-.066-1.233-.697V4.308c0-.63.692-1.01 1.233-.696l6.363 3.692a.802.802 0 0 1 0 1.393"/>\n                        </svg>\n                        Play     \n                    </div>\n                    <div id="btn-shuffle-music-small" class="button-play-opera">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="23" height="23" fill="var(--primary-color)" class="bi bi-shuffle svg-music" viewBox="0 0 16 16">\n                            <path fill-rule="evenodd" d="M0 3.5A.5.5 0 0 1 .5 3H1c2.202 0 3.827 1.24 4.874 2.418.49.552.865 1.102 1.126 1.532.26-.43.636-.98 1.126-1.532C9.173 4.24 10.798 3 13 3v1c-1.798 0-3.173 1.01-4.126 2.082A9.6 9.6 0 0 0 7.556 8a9.6 9.6 0 0 0 1.317 1.918C9.828 10.99 11.204 12 13 12v1c-2.202 0-3.827-1.24-4.874-2.418A10.6 10.6 0 0 1 7 9.05c-.26.43-.636.98-1.126 1.532C4.827 11.76 3.202 13 1 13H.5a.5.5 0 0 1 0-1H1c1.798 0 3.173-1.01 4.126-2.082A9.6 9.6 0 0 0 6.444 8a9.6 9.6 0 0 0-1.317-1.918C4.172 5.01 2.796 4 1 4H.5a.5.5 0 0 1-.5-.5"/>\n                            <path d="M13 5.466V1.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192m0 9v-3.932a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384l-2.36 1.966a.25.25 0 0 1-.41-.192"/>\n                        </svg>\n                        Suffle\n                    </div>\n                    <div id="btn-share-music-small" class="button-play-opera-share"  data-clipboard-text="${Constants.URL("music",`&idMusic=${this.elementId}`)}">\n                        <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="bi bi-share-fill" viewBox="0 0 16 16">\n                            <path d="M11 2.5a2.5 2.5 0 1 1 .603 1.628l-6.718 3.12a2.5 2.5 0 0 1 0 1.504l6.718 3.12a2.5 2.5 0 1 1-.488.876l-6.718-3.12a2.5 2.5 0 1 1 0-3.256l6.718-3.12A2.5 2.5 0 0 1 11 2.5"/>\n                        </svg>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class="songs-container">\n            <div class="inner-songs-container" id="container-canzoni">\n                ${this.opera.canzoni.map(((canzone,i)=>`\n                    <div class="container-canzone container-song ${i%2===0?"bg-active":""}">\n                            <div class="left-info-song">\n                                <span class="number-song">\n                                ${i+1}\n                                </span>\n                                <span class="name-song">\n                                ${canzone.name}                                          \n                                </span>\n                                ${canzone.isExplicit?Constants.EXPLICIT("span",14,0,3):""}\n                            </div>\n                            <div class="right-info-song">\n                               ${Constants.LOADING_THIRD(`animated-circle-element-${i}`,20,0,0,0,10,0,7)}\n                            </div>\n                        </div>\n                    `)).join("")}\n            </div>\n        </div>\n\n\n        <div class="songs-container-small">\n            <div class="inner-songs-container-small" id="container-canzoni-small">\n                ${this.opera.canzoni.map(((canzone,i)=>`\n                    <div class="container-canzone-small container-song-small ${i%2===0?"bg-active":""}">\n                            <div class="left-info-song-small">\n                                <span class="number-song-small">\n                                ${i+1}\n                                </span>\n                                <span class="name-song-small">\n                                ${canzone.name}                                          \n                                </span>\n                                ${canzone.isExplicit?Constants.EXPLICIT("span",14,0,3):""}\n                            </div>\n                            <div class="right-info-song-small">\n                            ${Constants.LOADING_THIRD(`animated-circle-element-small-${i}`,20,0,0,0,10,0,7)}\n                            </div>\n                        </div>\n                    `)).join("")}\n            </div>\n        </div>\n\n\n\n\n                    <div class="container-footer-music">\n\n                        <div class="footer-music">\n\n\n                            <div class="footer-music-elem">${(()=>{const mesi=["gennaio","febbraio","marzo","aprile","maggio","giugno","luglio","agosto","settembre","ottobre","novembre","dicembre"];const date=new Date(this.opera.prodotto.annoDiProduzione);const giorno=date.getDate();const mese=date.getMonth();const anno=date.getFullYear();return`${giorno} ${mesi[mese]} ${anno}`})()}</div>\n                            <div class="footer-music-elem" >\n                            <span>${this.opera.canzoni.length} bran${this.opera.canzoni.length==1?"o":"i"}&nbsp</span>\n                            <span id="total-time-span"></span> \n                            \n                            </div>\n                            <div class="footer-music-elem">${this.opera.prodotto.copyright}</div>\n\n\n\n\n                        </div>\n\n                        \n\n                    </div>\n\n\n                </div>\n            </div>\n\n        `}class App{constructor(page,singleId,albumId,idArtist,idMusic,musicIdSession,albumIdSession){this.musicIdSession=musicIdSession;this.albumIdSession=albumIdSession;this.idArtist=idArtist;this.idMusic=idMusic;this.page=page;this.albumId=albumId;this.singleId=singleId;this.footer=new Footer("footer");this.header=new Header("header");this.navbar=new Navbar("navbar",this.callbacksManager().navbar,this.albumId,this.singleId);this.main=new Main(this.callbacksManager().main,this.musicIdSession!=-1&&this.albumIdSession!=-1?true:false)}init=()=>{this.header.init();this.footer.init();this.navbar.init(this.page=="home"?"Accedi per caricare brani":`${Constants.CHEVRON_LEFT} Home`,this.page=="home"?`${Constants.CHEVRON_LEFT} Home`:"Accedi per caricare brani",this.page=="home"?this.callbacksManager().navbar.goToProfile:this.callbacksManager().navbar.goToHome);this.main.init(this.page,this.page=="artist"?this.idArtist:this.page=="music"?this.idMusic:-1,this.navbar.isLoaded)};callbacksManager=()=>{const callbacksMain=()=>{const getIsPlaying=()=>this.navbar.getIsPlaying();const getAlbumId=()=>this.navbar.albumId;const getSingleId=()=>this.navbar.singleId;const togglePlay=(albumId,element)=>{if(this.navbar.isDownloading==false&&this.navbar.isToggleClicked==false){Animations.fade(element,(()=>{this.navbar.togglePlayCallback(albumId)}))}};const checkAvailableSong=()=>this.navbar.checkAvailableSong();const togglePlaySong=(albumId,songId)=>this.navbar.togglePlaySong(albumId,songId);const onlyPlay=albumId=>{if(this.navbar.isDownloading==false&&this.navbar.isToggleClicked==false){this.navbar.togglePlayCallback(albumId)}};const onlyShuffle=albumId=>{if(this.navbar.isDownloading==false&&this.navbar.isToggleClicked==false){this.navbar.toggleShuffle(albumId)}};const shuffle=(albumId,element)=>{if(this.navbar.isDownloading==false&&this.navbar.isToggleClicked==false){Animations.fade(element,(()=>{this.navbar.toggleShuffle(albumId)}))}};const initNavbar=page=>{this.navbar.setupDynamicbar(page=="home"?"Accedi per caricare brani":`${Constants.CHEVRON_LEFT} Home`,page=="home"?`${Constants.CHEVRON_LEFT} Home`:"Accedi per caricare brani",page=="home"?this.callbacksManager().navbar.goToProfile:this.callbacksManager().navbar.goToHome)};const setMusicList=async elementId=>{this.navbar.setMusicList(elementId)};return{onlyPlay:onlyPlay,onlyShuffle:onlyShuffle,getAlbumId:getAlbumId,getIsPlaying:getIsPlaying,getSingleId:getSingleId,initNavbar:initNavbar,setMusicList:setMusicList,checkAvailableSong:checkAvailableSong,togglePlaySong:togglePlaySong,togglePlay:togglePlay,shuffle:shuffle}};const callbacksNavbar=()=>{const updateMusic=forceInx=>{if(this.main.page=="music"){this.main.updateMusic(this.navbar.albumId,forceInx)}};const goToHome=()=>{if(this.main.page!="home"){this.main.init("home",-1,this.navbar.isLoaded)}};const goToProfile=()=>{if(this.main.page!="home"){this.main.init("home",-1,this.navbar.isLoaded)}};const goToMusic=idAlbum=>{if(this.main.page!="music"||this.main.music.elementId!=idAlbum){this.main.init("music",idAlbum,this.navbar.isLoaded)}else{Constants.scrollTop()}};return{updateMusic:updateMusic,goToHome:goToHome,goToProfile:goToProfile,goToMusic:goToMusic}};return{navbar:callbacksNavbar(),main:callbacksMain()}}}fetch("./config/json.php").then((response=>response.json())).then((data=>{if(data.error){console.error("Error:",data.error);return}const theme=data.theme;document.body.setAttribute("data-theme",theme);const favicon=document.createElement("link");favicon.rel="icon";favicon.type="image/png";favicon.href=`./assets/images/favicon-${theme}.png`;document.head.appendChild(favicon);const app=new App(data.page,data.musicId,data.albumId,data.idArtist,data.idMusic,"home");app.init()})).catch((error=>console.error("Fetch error:",error)));
